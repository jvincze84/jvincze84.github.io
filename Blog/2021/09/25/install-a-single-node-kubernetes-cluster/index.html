
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://readthedocs.vinczejanos.info/Blog/2021/09/25/install-a-single-node-kubernetes-cluster/">
      
      
      
        <link rel="next" href="../../../10/01/how-to-use-mkdocs-with-docker/">
      
      
        
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Install A Single Node Kubernetes "Cluster" - Vincze Janos Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../css/width.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#install-a-single-node-kubernetes-cluster" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="Vincze Janos Blog" class="md-header__button md-logo" aria-label="Vincze Janos Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Vincze Janos Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Install A Single Node Kubernetes "Cluster"
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-green" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/jvincze84/jvincze84.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Vincze Janos Blog" class="md-nav__button md-logo" aria-label="Vincze Janos Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Vincze Janos Blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jvincze84/jvincze84.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome Here
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Tips_And_Tricks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tips And Tricks 2024a
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../new-file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ez egy uj test file
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes Templates
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Kubernetes Templates
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Kubernetes_Templates/ConfigMap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ConfigMap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Kubernetes_Templates/Deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Kubernetes_Templates/Ingress/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ingress
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Kubernetes_Templates/PersistentVolumeClaim/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PersistentVolumeClaim
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Kubernetes_Templates/ReverseProxy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kubernetes Reverse Proxy With Ingress, Service And Endpoint
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Kubernetes_Templates/Secret/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Secret
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Kubernetes_Templates/StatefulSet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    StatefulSet
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Kubernetes_Templates/services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Services
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Old Blog Contents
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Old Blog Contents
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Linux
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Linux
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/linux/Compile_Apache_Httpd_2.4.x_Php/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Compile Apache HTTPD 2.4.X &amp; PHP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/linux/Create_Self_Signed_Certificate_For_Apache_Webserver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Create Self Signed Certificate For Apache Webserver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/linux/Install_%28compile%29_%26_Configure_Motion_Av_Tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install (compile) & Configure Motion Av Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/linux/Install_Mps-youtube_Console_Based_Youtube_Player/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install Mps youtube Console Based Youtube Player
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/linux/create_Your_Own_Dyndns_Service_With_Bind_named/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    create Your Own Dyndns Service With Bind named
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Nodemcu
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Nodemcu
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/nodemcu/How_To_Compile_Nodemcu_Firmware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How To Compile Nodemcu Firmware
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/nodemcu/How_To_Unbrick_Esp8266_blinking_Blue_Led/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How To Unbrick Esp8266 blinking Blue Led
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/nodemcu/Install_Openalpr_On_Raspberry_Pi_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install OpenALPR on Raspberry PI 3
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/nodemcu/Logging_Mqtt_Data_%28subscription%29_To_Mysql_With_Shell_Script/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Logging Mqtt Data (subscription) To Mysql With Shell Script
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/nodemcu/Reliable_MQTT_conenction_with_NodeMCU/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reliable MQTT conenction with NodeMCU
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/nodemcu/Reliable_Mqtt_Connection_With_Nodemcu_%28part_2%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reliable Mqtt Connection With Nodemcu (part 2)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/nodemcu/Very_Simple_Way_To_Send_Email_Using_Nodemcu_Firmware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Very Simple Way to Send Email Using NodeMCU firmware
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Other
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Other
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/other/Collect_Network_Statistic_With_Telegraf_Vnstat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Collect Network Statistic With Telegraf &amp; VNSTAT
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/other/Iptables_Examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Iptables Examples
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/other/Nokia_6120c_%28bb5%29_Forgotten_Security_Code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nokia 6120c (BB5) Forgotten Security Code
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/other/Sonoff_Relays_With_Openhab_And_Tasmota_Firmware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sonoff Relays With OpenHab And Tasmota Firmware
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Raspberry
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Raspberry
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/raspberry/Compile_Go_Language_On_Raspberry_Pi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Compile Go Language On Raspberry Pi
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/raspberry/Google_Cloud_Print_With_Orange_Pi_or_Rpi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Google Cloud Print With Orange Pi or Rpi
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/raspberry/How_To_Install_Nodered_On_Raspberry_Pi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How To Install Nodered On Raspberry Pi
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/raspberry/Install_Debian_Jessie_To_Orange_Pi_Plus_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install Debian Jessie to Orange PI Plus 2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/raspberry/Install_Openalpr_On_Raspberry_Pi_3_part_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install Openalpr On Raspberry Pi 3 part 2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/raspberry/Mount_Sd_Card_Image_partitioned_Image_Wo_Kpartx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mount SD card image (partitioned image) w/o kpartx
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/raspberry/Move_Root_File_System_To_Usb_Storage_%28rpi2_%26_Rpi3%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Move root file system to USB storage (RPI2 &amp; RPI3)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/raspberry/Raspberry_Pi_2_As_Print_Server_Airprint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Raspberry Pi 2 As Print Server Airprint
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../Old_Blog_Contents/raspberry/Raspberry_Pi_3_As_Wifi_Range_Extender/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Raspberry Pi 3 As Wifi Range Extender
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisite" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisite
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-container-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install Container Runtime
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Install Container Runtime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fix-crictl-error" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fix crictl error
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install Kubernetes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Install Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-kubeadm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing kubeadm
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#init-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        Init the cluster
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-my-node-is-in-notready-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why my node is in NotReady state?
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#post-installation-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Post Installation Steps
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Post Installation Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scale-down-the-coredns-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scale Down The CoreDNS Deployment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-kuberntes-metrics-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install Kuberntes Metrics Server
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-nginx-ingress-controller" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install (Nginx) Ingress Controller
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Install (Nginx) Ingress Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-an-application-and-create-service-and-ingress-for-it" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deploy An Application And Create Service And Ingress For It
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dns-entries" class="md-nav__link">
    <span class="md-ellipsis">
      
        DNS Entries
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-kubernetes-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install Kubernetes Dashboard
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Install Kubernetes Dashboard">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-an-ingress" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create An Ingress
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-token" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Token
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fix-permission" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fix Permission
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cheatsheet" class="md-nav__link">
    <span class="md-ellipsis">
      
        CheatSheet
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CheatSheet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#list-and-delete-completed-pods" class="md-nav__link">
    <span class="md-ellipsis">
      
        List And Delete Completed PODS
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-container-logs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Check Container Logs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-into-the-container" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get Into The Container
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pending-pods-nginx-ingress" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pending PODS (nginx ingress)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-all-all-namespaces" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get All / All Namespaces
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#print-join-command-add-worker-node" class="md-nav__link">
    <span class="md-ellipsis">
      
        Print Join Command (Add Worker Node)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-all-resources-get-help" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get All Resources / Get Help
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy-dir-file-from-container" class="md-nav__link">
    <span class="md-ellipsis">
      
        Copy Dir / File From Container
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2021-09-25 00:00:00+00:00" class="md-ellipsis">September 25, 2021</time>
                      </div>
                    </li>
                    
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              20 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  



  
  


<h1 id="install-a-single-node-kubernetes-cluster">Install A Single Node Kubernetes "Cluster"<a class="headerlink" href="#install-a-single-node-kubernetes-cluster" title="Permanent link">&para;</a></h1>
<p>In this article we will install a single node kubernetes cluster on Debian 11 (bullseye). I will walk through step by step all the commands and configurations.</p>
<!-- more -->

<h2 id="prerequisite">Prerequisite<a class="headerlink" href="#prerequisite" title="Permanent link">&para;</a></h2>
<p>I'm using a really old system for this demonstration:</p>
<ul>
<li>CPU: Intel(R) Core(TM)2 CPU 6400  @ 2.13GHz (Dell Optiplex 745)</li>
<li>Mem: 4 GB</li>
<li>Disk: 500 GB HDD</li>
<li>OS: Debian GNU/Linux 11 (bullseye)</li>
</ul>
<p>After successfully installation of my Debian system, install some necessary tools:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>apt-get<span class="w"> </span>install<span class="w"> </span>vim<span class="w"> </span>mc<span class="w"> </span>net-tools<span class="w"> </span>sudo<span class="w"> </span>jq
</code></pre></div>
<ul>
<li>(Optional) Change sudoers file:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="gd">--- /etc/sudoers-orig 2021-10-11 10:14:00.276397052 +0200</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="gi">+++ /etc/sudoers  2021-10-11 10:14:20.832894911 +0200</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="gu">@@ -20,7 +20,7 @@</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w"> </span>root ALL=(ALL:ALL) ALL
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w"> </span># Allow members of group sudo to execute any command
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="gd">-%sudo  ALL=(ALL:ALL) ALL</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="gi">+%sudo  ALL=(ALL:ALL) NOPASSWD:ALL</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w"> </span># See sudoers(5) for more information on &quot;@include&quot; directives:
</code></pre></div>
<ul>
<li>Add user to <code>sudo</code> group (<code>/usr/sbin/visudo</code>)</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>/usr/sbin/usermod<span class="w"> </span>-aG<span class="w"> </span>sudo<span class="w"> </span>kube
</code></pre></div>
<h2 id="install-container-runtime">Install Container Runtime<a class="headerlink" href="#install-container-runtime" title="Permanent link">&para;</a></h2>
<p>I always recommend to follow the official installation guide: <a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes">https://kubernetes.io/docs/setup/production-environment/container-runtimes</a>
Everything is well docomented and easy to follow. </p>
<p>Kubernetes will leave Docker support so we will use Containerd as container runtime. </p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Read more about Docker vs Kubernetes: <a href="https://kubernetes.io/blog/2020/12/02/dont-panic-kubernetes-and-docker/">https://kubernetes.io/blog/2020/12/02/dont-panic-kubernetes-and-docker/</a></p>
</div>
<p>Before you start you may want to check the official Docker installation page: <a href="https://docs.docker.com/engine/install/debian/">https://docs.docker.com/engine/install/debian/</a></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>I know that I post a lot of link as references, but it is really important to understand how important is it to always read the official documentation.<br />
Almost all these installation steps are copy-pasted from the official sites. </p>
</div>
<ul>
<li>Install requirements</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>sudo<span class="w"> </span>bash
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>apt-get<span class="w"> </span>install<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span>apt-transport-https<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span>ca-certificates<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span>curl<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span>gnupg<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span>lsb-release
</code></pre></div>
<ul>
<li>Add GPG key</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://download.docker.com/linux/debian/gpg<span class="w"> </span><span class="p">|</span><span class="w">  </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/usr/share/keyrings/docker-archive-keyring.gpg
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nb">echo</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">  </span><span class="s2">&quot;deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2"> signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/debian \</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="s2">  </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> stable&quot;</span><span class="w"> </span><span class="p">|</span><span class="w">  </span>tee<span class="w"> </span>/etc/apt/sources.list.d/docker.list<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
</code></pre></div>
<ul>
<li>Install Docker &amp; containerd</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>apt-get<span class="w"> </span>update
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>apt-get<span class="w"> </span>install<span class="w"> </span>docker-ce<span class="w"> </span>docker-ce-cli<span class="w"> </span>containerd.io
</code></pre></div>
<ul>
<li>Check the installtion</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>docker<span class="w"> </span>info
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>docker<span class="w"> </span>run<span class="w"> </span>hello-world
</code></pre></div>
<ul>
<li>Prepare Containerd for Kubernetes</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF |  tee /etc/modules-load.d/containerd.conf</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="s">overlay</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="s">br_netfilter</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="s">EOF</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>modprobe<span class="w"> </span>overlay
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>modprobe<span class="w"> </span>br_netfilter
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | tee /etc/sysctl.d/99-kubernetes-cri.conf</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="s">net.bridge.bridge-nf-call-iptables  = 1</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="s">net.ipv4.ip_forward                 = 1</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="s">net.bridge.bridge-nf-call-ip6tables = 1</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="s">EOF</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>sysctl<span class="w"> </span>--system
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/containerd
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>containerd<span class="w"> </span>config<span class="w"> </span>default<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/etc/containerd/config.toml
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>containerd
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>systemctl<span class="w"> </span>status<span class="w"> </span>containerd
</code></pre></div>
<ul>
<li>Using the systemd cgroup drive</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>cp<span class="w"> </span>/etc/containerd/config.toml<span class="w"> </span>/etc/containerd/config.toml-orig
</code></pre></div>
<p><strong>Edit the <code>/etc/containerd/config.toml</code> file</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="gd">--- /etc/containerd/config.toml-orig  2021-10-11 10:33:39.603577510 +0200</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="gi">+++ /etc/containerd/config.toml 2021-10-11 10:35:01.753393462 +0200</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="gu">@@ -94,6 +94,7 @@</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w"> </span>          privileged_without_host_devices = false
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w"> </span>          base_runtime_spec = &quot;&quot;
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w"> </span>          [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="gi">+            SystemdCgroup = true</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w"> </span>    [plugins.&quot;io.containerd.grpc.v1.cri&quot;.cni]
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w"> </span>      bin_dir = &quot;/opt/cni/bin&quot;
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w"> </span>      conf_dir = &quot;/etc/cni/net.d&quot;
</code></pre></div>
<h3 id="fix-crictl-error">Fix <code>crictl</code> error<a class="headerlink" href="#fix-crictl-error" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="hll">crictl ps
</span><a id="__codelineno-12-2" name="__codelineno-12-2"></a>FATA[0010] failed to connect: failed to connect: context deadline exceeded
</code></pre></div></td></tr></table></div>
<p>Fix:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF&gt;/etc/crictl.yaml</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="s">runtime-endpoint: unix:///run/containerd/containerd.sock</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="s">image-endpoint: unix:///run/containerd/containerd.sock</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="s">timeout: 2</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="s">debug: false</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="s">pull-image-on-create: false</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="s">EOF</span>
</code></pre></div>
<p>Reference: <a href="https://github.com/cri-o/cri-o/issues/1922#issuecomment-828275332">https://github.com/cri-o/cri-o/issues/1922#issuecomment-828275332</a></p>
<h2 id="install-kubernetes">Install Kubernetes<a class="headerlink" href="#install-kubernetes" title="Permanent link">&para;</a></h2>
<p>Follow the steps described here: <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/</a></p>
<h3 id="installing-kubeadm">Installing kubeadm<a class="headerlink" href="#installing-kubeadm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF |  tee /etc/modules-load.d/k8s.conf</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="s">br_netfilter</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="s">EOF</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF |  tee /etc/sysctl.d/k8s.conf</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="s">net.bridge.bridge-nf-call-ip6tables = 1</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="s">net.bridge.bridge-nf-call-iptables = 1</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="s">EOF</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>sysctl<span class="w"> </span>--system
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>apt-get<span class="w"> </span>update
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>apt-transport-https<span class="w"> </span>ca-certificates<span class="w"> </span>curl
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="c1"># The URL has been changed! curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key<span class="w"> </span><span class="p">|</span><span class="w">  </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/etc/apt/keyrings/kubernetes-apt-keyring.gpg
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="c1"># Deprecated : echo &quot;deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&quot; |  tee /etc/apt/sources.list.d/kubernetes.list</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /&#39;</span><span class="w"> </span><span class="p">|</span><span class="w">  </span>tee<span class="w"> </span>/etc/apt/sources.list.d/kubernetes.list
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>apt-get<span class="w"> </span>update
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Location of the keyring and the source has been changed. If you need older version please modify the url accordingly.
Example: <code>deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.27/deb/ /'</code></p>
</div>
<p>Now we do some extra steps before installing the kubeadm. In the world of Kubernetes it is important to install the same version of kubeadm kubelet and kubectl. So fist we check the avaiable versions:</p>
<p><div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># apt-cache madison kubeadm | egrep &#39;(1.22|1.21)&#39;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>apt-cache<span class="w"> </span>madison<span class="w"> </span>kubeadm
</code></pre></div>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>   kubeadm | 1.28.2-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb  Packages
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>   kubeadm | 1.28.1-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb  Packages
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>   kubeadm | 1.28.0-1.1 | https://pkgs.k8s.io/core:/stable:/v1.28/deb  Packages
</code></pre></div></p>
<p>We won't install the latest version in order to be able to show you an update process as well.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="nv">kubelet</span><span class="o">=</span><span class="m">1</span>.28.1-1.1<span class="w">  </span><span class="nv">kubeadm</span><span class="o">=</span><span class="m">1</span>.28.1-1.1<span class="w">  </span><span class="nv">kubectl</span><span class="o">=</span><span class="m">1</span>.28.1-1.1<span class="w"> </span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>apt-mark<span class="w"> </span>hold<span class="w"> </span>kubelet<span class="w"> </span>kubeadm<span class="w"> </span>kubectl
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>We don't want to update kubeadm, kubeclt and kubelet with system (os) updates (apt-get update &amp; upgrade). Kubernetes update has its own process. Always be careful when update you base system, and never update these packages alongside with the underlying os.</p>
</div>
<p><strong>Check the installed version</strong>
<div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>kubeadm<span class="w"> </span>version<span class="w"> </span>-o<span class="w"> </span>yaml
</code></pre></div>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>clientVersion:
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>  buildDate: &quot;2023-08-24T11:21:51Z&quot;
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>  compiler: gc
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>  gitCommit: 8dc49c4b984b897d423aab4971090e1879eb4f23
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>  gitTreeState: clean
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>  gitVersion: v1.28.1
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>  goVersion: go1.20.7
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>  major: &quot;1&quot;
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>  minor: &quot;28&quot;
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>  platform: linux/amd64
</code></pre></div></p>
<h3 id="init-the-cluster">Init the cluster<a class="headerlink" href="#init-the-cluster" title="Permanent link">&para;</a></h3>
<p>Check the breif help of the <code>kubeadm init</code> command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>kubeadm<span class="w"> </span>init<span class="w"> </span>--help
</code></pre></div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Disable SWAP before you start, otherwise you will get this error: <code>ERROR Swap]: running with swap on is not supported. Please disable swap</code><br />
To do this remove the corresponding line from <code>/etc/fstab</code> and run <code>swapoff --all</code> command.</p>
</div>
<p><strong>Options</strong></p>
<ul>
<li><code>--cri-socket /var/run/containerd/containerd.sock</code> --&gt; We want to use Containerd as container runtime insted of the default docker.</li>
<li><code>--service-cidr 10.22.0.0/16</code> and  <code>--pod-network-cidr 10.23.0.0/16</code> --&gt; Really important to size well your internal Kubernets network. Be sure that none of these IP address ranges don't overlap your phisical network, VPN connection or each other. Since this is only a demo system it will be enough about 250 IP address for PODS and Services. </li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>W0914 09:42:57.948845    4568 initconfiguration.go:120] <strong>Usage of CRI endpoints without URL scheme is deprecated</strong> and can cause kubelet errors in the future. Automatically prepending scheme "unix" to the "criSocket" with value "/var/run/containerd/containerd.sock". Please update your configuration!</p>
</div>
<p><div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Command</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span>
<span class="normal"><a href="#__codelineno-22-3">3</a></span>
<span class="normal"><a href="#__codelineno-22-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a>kubeadm<span class="w"> </span>init<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a>--cri-socket<span class="w"> </span>unix:///var/run/containerd/containerd.sock<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>--service-cidr<span class="w"> </span><span class="m">10</span>.22.0.0/16<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a>--pod-network-cidr<span class="w"> </span><span class="m">10</span>.23.0.0/16
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Output</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span>
<span class="normal"><a href="#__codelineno-23-23">23</a></span>
<span class="normal"><a href="#__codelineno-23-24">24</a></span>
<span class="normal"><a href="#__codelineno-23-25">25</a></span>
<span class="normal"><a href="#__codelineno-23-26">26</a></span>
<span class="normal"><a href="#__codelineno-23-27">27</a></span>
<span class="normal"><a href="#__codelineno-23-28">28</a></span>
<span class="normal"><a href="#__codelineno-23-29">29</a></span>
<span class="normal"><a href="#__codelineno-23-30">30</a></span>
<span class="normal"><a href="#__codelineno-23-31">31</a></span>
<span class="normal"><a href="#__codelineno-23-32">32</a></span>
<span class="normal"><a href="#__codelineno-23-33">33</a></span>
<span class="normal"><a href="#__codelineno-23-34">34</a></span>
<span class="normal"><a href="#__codelineno-23-35">35</a></span>
<span class="normal"><a href="#__codelineno-23-36">36</a></span>
<span class="normal"><a href="#__codelineno-23-37">37</a></span>
<span class="normal"><a href="#__codelineno-23-38">38</a></span>
<span class="normal"><a href="#__codelineno-23-39">39</a></span>
<span class="normal"><a href="#__codelineno-23-40">40</a></span>
<span class="normal"><a href="#__codelineno-23-41">41</a></span>
<span class="normal"><a href="#__codelineno-23-42">42</a></span>
<span class="normal"><a href="#__codelineno-23-43">43</a></span>
<span class="normal"><a href="#__codelineno-23-44">44</a></span>
<span class="normal"><a href="#__codelineno-23-45">45</a></span>
<span class="normal"><a href="#__codelineno-23-46">46</a></span>
<span class="normal"><a href="#__codelineno-23-47">47</a></span>
<span class="normal"><a href="#__codelineno-23-48">48</a></span>
<span class="normal"><a href="#__codelineno-23-49">49</a></span>
<span class="normal"><a href="#__codelineno-23-50">50</a></span>
<span class="normal"><a href="#__codelineno-23-51">51</a></span>
<span class="normal"><a href="#__codelineno-23-52">52</a></span>
<span class="normal"><a href="#__codelineno-23-53">53</a></span>
<span class="normal"><a href="#__codelineno-23-54">54</a></span>
<span class="normal"><a href="#__codelineno-23-55">55</a></span>
<span class="normal"><a href="#__codelineno-23-56">56</a></span>
<span class="normal"><a href="#__codelineno-23-57">57</a></span>
<span class="normal"><a href="#__codelineno-23-58">58</a></span>
<span class="normal"><a href="#__codelineno-23-59">59</a></span>
<span class="normal"><a href="#__codelineno-23-60">60</a></span>
<span class="normal"><a href="#__codelineno-23-61">61</a></span>
<span class="normal"><a href="#__codelineno-23-62">62</a></span>
<span class="normal"><a href="#__codelineno-23-63">63</a></span>
<span class="normal"><a href="#__codelineno-23-64">64</a></span>
<span class="normal"><a href="#__codelineno-23-65">65</a></span>
<span class="normal"><a href="#__codelineno-23-66">66</a></span>
<span class="normal"><a href="#__codelineno-23-67">67</a></span>
<span class="normal"><a href="#__codelineno-23-68">68</a></span>
<span class="normal"><a href="#__codelineno-23-69">69</a></span>
<span class="normal"><a href="#__codelineno-23-70">70</a></span>
<span class="normal"><a href="#__codelineno-23-71">71</a></span>
<span class="normal"><a href="#__codelineno-23-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a>[init] Using Kubernetes version: v1.28.2
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>[preflight] Running pre-flight checks
<a id="__codelineno-23-3" name="__codelineno-23-3"></a>[preflight] Pulling images required for setting up a Kubernetes cluster
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>[preflight] This might take a minute or two, depending on the speed of your internet connection
<a id="__codelineno-23-5" name="__codelineno-23-5"></a>[preflight] You can also perform this action in beforehand using &#39;kubeadm config images pull&#39;
<a id="__codelineno-23-6" name="__codelineno-23-6"></a>W0914 09:45:09.492639    6161 checks.go:835] detected that the sandbox image &quot;registry.k8s.io/pause:3.6&quot; of the container runtime is inconsistent with that used by kubeadm. It is recommended that using &quot;registry.k8s.io/pause:3.9&quot; as the CRI sandbox image.
<a id="__codelineno-23-7" name="__codelineno-23-7"></a>[certs] Using certificateDir folder &quot;/etc/kubernetes/pki&quot;
<a id="__codelineno-23-8" name="__codelineno-23-8"></a>[certs] Generating &quot;ca&quot; certificate and key
<a id="__codelineno-23-9" name="__codelineno-23-9"></a>[certs] Generating &quot;apiserver&quot; certificate and key
<a id="__codelineno-23-10" name="__codelineno-23-10"></a>[certs] apiserver serving cert is signed for DNS names [kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local singlek8s] and IPs [10.22.0.1 172.16.1.70]
<a id="__codelineno-23-11" name="__codelineno-23-11"></a>[certs] Generating &quot;apiserver-kubelet-client&quot; certificate and key
<a id="__codelineno-23-12" name="__codelineno-23-12"></a>[certs] Generating &quot;front-proxy-ca&quot; certificate and key
<a id="__codelineno-23-13" name="__codelineno-23-13"></a>[certs] Generating &quot;front-proxy-client&quot; certificate and key
<a id="__codelineno-23-14" name="__codelineno-23-14"></a>[certs] Generating &quot;etcd/ca&quot; certificate and key
<a id="__codelineno-23-15" name="__codelineno-23-15"></a>[certs] Generating &quot;etcd/server&quot; certificate and key
<a id="__codelineno-23-16" name="__codelineno-23-16"></a>[certs] etcd/server serving cert is signed for DNS names [localhost singlek8s] and IPs [172.16.1.70 127.0.0.1 ::1]
<a id="__codelineno-23-17" name="__codelineno-23-17"></a>[certs] Generating &quot;etcd/peer&quot; certificate and key
<a id="__codelineno-23-18" name="__codelineno-23-18"></a>[certs] etcd/peer serving cert is signed for DNS names [localhost singlek8s] and IPs [172.16.1.70 127.0.0.1 ::1]
<a id="__codelineno-23-19" name="__codelineno-23-19"></a>[certs] Generating &quot;etcd/healthcheck-client&quot; certificate and key
<a id="__codelineno-23-20" name="__codelineno-23-20"></a>[certs] Generating &quot;apiserver-etcd-client&quot; certificate and key
<a id="__codelineno-23-21" name="__codelineno-23-21"></a>[certs] Generating &quot;sa&quot; key and public key
<a id="__codelineno-23-22" name="__codelineno-23-22"></a>[kubeconfig] Using kubeconfig folder &quot;/etc/kubernetes&quot;
<a id="__codelineno-23-23" name="__codelineno-23-23"></a>[kubeconfig] Writing &quot;admin.conf&quot; kubeconfig file
<a id="__codelineno-23-24" name="__codelineno-23-24"></a>[kubeconfig] Writing &quot;kubelet.conf&quot; kubeconfig file
<a id="__codelineno-23-25" name="__codelineno-23-25"></a>[kubeconfig] Writing &quot;controller-manager.conf&quot; kubeconfig file
<a id="__codelineno-23-26" name="__codelineno-23-26"></a>[kubeconfig] Writing &quot;scheduler.conf&quot; kubeconfig file
<a id="__codelineno-23-27" name="__codelineno-23-27"></a>[etcd] Creating static Pod manifest for local etcd in &quot;/etc/kubernetes/manifests&quot;
<a id="__codelineno-23-28" name="__codelineno-23-28"></a>[control-plane] Using manifest folder &quot;/etc/kubernetes/manifests&quot;
<a id="__codelineno-23-29" name="__codelineno-23-29"></a>[control-plane] Creating static Pod manifest for &quot;kube-apiserver&quot;
<a id="__codelineno-23-30" name="__codelineno-23-30"></a>[control-plane] Creating static Pod manifest for &quot;kube-controller-manager&quot;
<a id="__codelineno-23-31" name="__codelineno-23-31"></a>[control-plane] Creating static Pod manifest for &quot;kube-scheduler&quot;
<a id="__codelineno-23-32" name="__codelineno-23-32"></a>[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;
<a id="__codelineno-23-33" name="__codelineno-23-33"></a>[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
<a id="__codelineno-23-34" name="__codelineno-23-34"></a>[kubelet-start] Starting the kubelet
<a id="__codelineno-23-35" name="__codelineno-23-35"></a>[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &quot;/etc/kubernetes/manifests&quot;. This can take up to 4m0s
<a id="__codelineno-23-36" name="__codelineno-23-36"></a>[apiclient] All control plane components are healthy after 4.002225 seconds
<a id="__codelineno-23-37" name="__codelineno-23-37"></a>[upload-config] Storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace
<a id="__codelineno-23-38" name="__codelineno-23-38"></a>[kubelet] Creating a ConfigMap &quot;kubelet-config&quot; in namespace kube-system with the configuration for the kubelets in the cluster
<a id="__codelineno-23-39" name="__codelineno-23-39"></a>[upload-certs] Skipping phase. Please see --upload-certs
<a id="__codelineno-23-40" name="__codelineno-23-40"></a>[mark-control-plane] Marking the node singlek8s as control-plane by adding the labels: [node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]
<a id="__codelineno-23-41" name="__codelineno-23-41"></a>[mark-control-plane] Marking the node singlek8s as control-plane by adding the taints [node-role.kubernetes.io/control-plane:NoSchedule]
<a id="__codelineno-23-42" name="__codelineno-23-42"></a>[bootstrap-token] Using token: m8tywn.9f3xegmdoa30d8v4
<a id="__codelineno-23-43" name="__codelineno-23-43"></a>[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
<a id="__codelineno-23-44" name="__codelineno-23-44"></a>[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes
<a id="__codelineno-23-45" name="__codelineno-23-45"></a>[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
<a id="__codelineno-23-46" name="__codelineno-23-46"></a>[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
<a id="__codelineno-23-47" name="__codelineno-23-47"></a>[bootstrap-token] Configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
<a id="__codelineno-23-48" name="__codelineno-23-48"></a>[bootstrap-token] Creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace
<a id="__codelineno-23-49" name="__codelineno-23-49"></a>[kubelet-finalize] Updating &quot;/etc/kubernetes/kubelet.conf&quot; to point to a rotatable kubelet client certificate and key
<a id="__codelineno-23-50" name="__codelineno-23-50"></a>[addons] Applied essential addon: CoreDNS
<a id="__codelineno-23-51" name="__codelineno-23-51"></a>[addons] Applied essential addon: kube-proxy
<a id="__codelineno-23-52" name="__codelineno-23-52"></a>
<a id="__codelineno-23-53" name="__codelineno-23-53"></a>Your Kubernetes control-plane has initialized successfully!
<a id="__codelineno-23-54" name="__codelineno-23-54"></a>
<a id="__codelineno-23-55" name="__codelineno-23-55"></a>To start using your cluster, you need to run the following as a regular user:
<a id="__codelineno-23-56" name="__codelineno-23-56"></a>
<a id="__codelineno-23-57" name="__codelineno-23-57"></a><span class="hll">  mkdir -p $HOME/.kube
</span><a id="__codelineno-23-58" name="__codelineno-23-58"></a><span class="hll">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
</span><a id="__codelineno-23-59" name="__codelineno-23-59"></a><span class="hll">  sudo chown $(id -u):$(id -g) $HOME/.kube/config
</span><a id="__codelineno-23-60" name="__codelineno-23-60"></a><span class="hll">
</span><a id="__codelineno-23-61" name="__codelineno-23-61"></a><span class="hll">Alternatively, if you are the root user, you can run:
</span><a id="__codelineno-23-62" name="__codelineno-23-62"></a><span class="hll">
</span><a id="__codelineno-23-63" name="__codelineno-23-63"></a><span class="hll">  export KUBECONFIG=/etc/kubernetes/admin.conf
</span><a id="__codelineno-23-64" name="__codelineno-23-64"></a>
<a id="__codelineno-23-65" name="__codelineno-23-65"></a>You should now deploy a pod network to the cluster.
<a id="__codelineno-23-66" name="__codelineno-23-66"></a>Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
<a id="__codelineno-23-67" name="__codelineno-23-67"></a>  https://kubernetes.io/docs/concepts/cluster-administration/addons/
<a id="__codelineno-23-68" name="__codelineno-23-68"></a>
<a id="__codelineno-23-69" name="__codelineno-23-69"></a>Then you can join any number of worker nodes by running the following on each as root:
<a id="__codelineno-23-70" name="__codelineno-23-70"></a>
<a id="__codelineno-23-71" name="__codelineno-23-71"></a>kubeadm join 172.16.1.70:6443 --token m8tywn.9f3xegmdoa30d8v4 \
<a id="__codelineno-23-72" name="__codelineno-23-72"></a>        --discovery-token-ca-cert-hash sha256:4ee5a244df12c803c78ba4bf55518d6c0f7ef84e655d4bce1cb40f8c967d60c2
</code></pre></div></td></tr></table></div></p>
<p>Beleve or not our Single node Kubernetes cluster is almost ready. :)</p>
<p>Check it:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span>
<span class="normal"><a href="#__codelineno-24-2">2</a></span>
<span class="normal"><a href="#__codelineno-24-3">3</a></span>
<span class="normal"><a href="#__codelineno-24-4">4</a></span>
<span class="normal"><a href="#__codelineno-24-5">5</a></span>
<span class="normal"><a href="#__codelineno-24-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$HOME</span>/.kube
<a id="__codelineno-24-2" name="__codelineno-24-2"></a>sudo<span class="w"> </span>cp<span class="w"> </span>-i<span class="w"> </span>/etc/kubernetes/admin.conf<span class="w"> </span><span class="nv">$HOME</span>/.kube/config
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>sudo<span class="w"> </span>chown<span class="w"> </span><span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span>:<span class="k">$(</span>id<span class="w"> </span>-g<span class="k">)</span><span class="w"> </span><span class="nv">$HOME</span>/.kube/config
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">KUBECONFIG</span><span class="o">=</span>/etc/kubernetes/admin.conf
<a id="__codelineno-24-5" name="__codelineno-24-5"></a>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a>kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>-o<span class="w"> </span>wide
</code></pre></div></td></tr></table></div>
<p>Output looks like this:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a>NAME        STATUS   ROLES                  AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION   CONTAINER-RUNTIME
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>singlek8s   Ready    control-plane,worker   21m   v1.28.1   172.16.1.70   &lt;none&gt;        Debian GNU/Linux 12 (bookworm)   6.1.0-12-amd64   containerd://1.6.22
</code></pre></div></td></tr></table></div></p>
<p>It is beutiful, isn't it?</p>
<h3 id="why-my-node-is-in-notready-state">Why my node is in <code>NotReady</code> state?<a class="headerlink" href="#why-my-node-is-in-notready-state" title="Permanent link">&para;</a></h3>
<p>I can say that this behavior is normal in case of newly installed Kubernetes cluster. Check the reaseon:</p>
<p><div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>--all-namespaces<span class="w"> </span>-o<span class="w"> </span>wide
</code></pre></div>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>NAMESPACE     NAME                                READY   STATUS    RESTARTS        AGE    IP            NODE        NOMINATED NODE   READINESS GATES
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>kube-system   coredns-5dd5756b68-756n6            0/1     Pending   0               18s    &lt;none&gt;        &lt;none&gt;      &lt;none&gt;           &lt;none&gt;
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>kube-system   coredns-5dd5756b68-l82qm            0/1     Pending   0               18s    &lt;none&gt;        &lt;none&gt;      &lt;none&gt;           &lt;none&gt;
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>kube-system   etcd-singlek8s                      1/1     Running   3 (2m20s ago)   106s   172.16.1.70   singlek8s   &lt;none&gt;           &lt;none&gt;
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>kube-system   kube-apiserver-singlek8s            1/1     Running   4 (59s ago)     106s   172.16.1.70   singlek8s   &lt;none&gt;           &lt;none&gt;
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>kube-system   kube-controller-manager-singlek8s   1/1     Running   4 (78s ago)     106s   172.16.1.70   singlek8s   &lt;none&gt;           &lt;none&gt;
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>kube-system   kube-proxy-rkqnk                    1/1     Running   1 (25s ago)     89s    172.16.1.70   singlek8s   &lt;none&gt;           &lt;none&gt;
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>kube-system   kube-scheduler-singlek8s            1/1     Running   4 (78s ago)     106s   172.16.1.70   singlek8s   &lt;none&gt;           &lt;none&gt;
</code></pre></div></p>
<p>You can see that the coredns pods are in pending state. These pods are responsible for internal DNS queries inside the Cluster Network. What should be the problem? We don't have any network plugin installed in the cluster....</p>
<p>Links: </p>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/">https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/</a></li>
<li><a href="https://kubevious.io/blog/post/comparing-kubernetes-container-network-interface-cni-providers">https://kubevious.io/blog/post/comparing-kubernetes-container-network-interface-cni-providers</a></li>
</ul>
<p>As you can see that there are a lot of varions of network plugins. For this little home environment I chose weave: <a href="https://www.weave.works/docs/net/latest/kubernetes/kube-addon/#install">https://www.weave.works/docs/net/latest/kubernetes/kube-addon/#install</a></p>
<p>It is really simple to install, can be achieved with only one command:</p>
<p><div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># Depreaceted: kubectl apply -f &quot;https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d &#39;\n&#39;)&quot;</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/weaveworks/weave/releases/download/v2.8.1/weave-daemonset-k8s.yaml
</code></pre></div>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>serviceaccount/weave-net created
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>clusterrole.rbac.authorization.k8s.io/weave-net created
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>clusterrolebinding.rbac.authorization.k8s.io/weave-net created
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>role.rbac.authorization.k8s.io/weave-net created
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>rolebinding.rbac.authorization.k8s.io/weave-net created
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>daemonset.apps/weave-net created
</code></pre></div></p>
<p>Check again the cluster:</p>
<p><div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>--all-namespaces<span class="w"> </span>-o<span class="w"> </span>wide
</code></pre></div>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>NAMESPACE     NAME                                READY   STATUS    RESTARTS        AGE     IP            NODE        NOMINATED NODE   READINESS GATES
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>kube-system   coredns-5dd5756b68-756n6            1/1     Running   2 (6m11s ago)   17m     10.32.0.1     singlek8s   &lt;none&gt;           &lt;none&gt;
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>kube-system   coredns-5dd5756b68-l82qm            1/1     Running   1 (9m29s ago)   17m     10.32.0.3     singlek8s   &lt;none&gt;           &lt;none&gt;
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>kube-system   etcd-singlek8s                      1/1     Running   6 (3m55s ago)   19m     172.16.1.70   singlek8s   &lt;none&gt;           &lt;none&gt;
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>kube-system   kube-apiserver-singlek8s            1/1     Running   8 (3m13s ago)   19m     172.16.1.70   singlek8s   &lt;none&gt;           &lt;none&gt;
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>kube-system   kube-controller-manager-singlek8s   1/1     Running   9 (5m52s ago)   19m     172.16.1.70   singlek8s   &lt;none&gt;           &lt;none&gt;
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>kube-system   kube-proxy-rkqnk                    1/1     Running   7 (4m7s ago)    19m     172.16.1.70   singlek8s   &lt;none&gt;           &lt;none&gt;
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>kube-system   kube-scheduler-singlek8s            1/1     Running   9 (7m30s ago)   19m     172.16.1.70   singlek8s   &lt;none&gt;           &lt;none&gt;
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>kube-system   weave-net-68qbb                     2/2     Running   0               8m36s   172.16.1.70   singlek8s   &lt;none&gt;           &lt;none&gt;
</code></pre></div></p>
<p><div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>-o<span class="w"> </span>wide
</code></pre></div>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>NAME        STATUS   ROLES                  AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION   CONTAINER-RUNTIME
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>kube-test   Ready    control-plane,master   18m   v1.21.5   172.16.1.214   &lt;none&gt;        Debian GNU/Linux 11 (bullseye)   5.10.0-9-amd64   containerd://1.4.11
</code></pre></div></p>
<p>Now we really have a working single node Kubernetes cluster. </p>
<p>Before jump to the next section take a look at the node role: <code>control-plane,master</code><br />
This means the only node we hava acts as control-plane and master, since we won't have any other worker nodes this nodes must have worker role as well:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>kubectl<span class="w"> </span>label<span class="w"> </span>node<span class="w"> </span>singlek8s<span class="w"> </span>node-role.kubernetes.io/worker<span class="o">=</span>
</code></pre></div>
<p>But this is not enoguh because the master nodes have taint by default: <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/</a></p>
<p>You can check the taint with <code>kubectl get node kube-test -o yaml</code> command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>...
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>  taints:
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>  - effect: NoSchedule
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>    key: node-role.kubernetes.io/control-plane
</code></pre></div>
<p>Remove this taint:
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>kube-test<span class="w"> </span>node-role.kubernetes.io/master<span class="o">=</span>:NoSchedule-
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>singlek8s<span class="w"> </span>node-role.kubernetes.io/control-plane-
</code></pre></div></p>
<h2 id="post-installation-steps">Post Installation Steps<a class="headerlink" href="#post-installation-steps" title="Permanent link">&para;</a></h2>
<h3 id="scale-down-the-coredns-deployment">Scale Down The CoreDNS Deployment<a class="headerlink" href="#scale-down-the-coredns-deployment" title="Permanent link">&para;</a></h3>
<p>Remember we have only one node in this demo cluster. It's not neccessary to have multiple instance of our applications, because all of them will run on this single node, and this behaviour doesn't give us any extras. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>kubectl<span class="w"> </span>edit<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>deployment<span class="w"> </span>coredns
</code></pre></div>
<p>Change the replicas to 1:
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="w">  </span><span class="nt">progressDeadlineSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">600</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</code></pre></div></p>
<p><strong>Check</strong>
<div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>get<span class="w"> </span>pods
</code></pre></div>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>NAME                                READY   STATUS    RESTARTS   AGE
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>coredns-558bd4d5db-l6gtq            1/1     Running   0          32m
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>etcd-kube-test                      1/1     Running   0          33m
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>kube-apiserver-kube-test            1/1     Running   0          33m
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>kube-controller-manager-kube-test   1/1     Running   0          33m
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>kube-proxy-nhm2h                    1/1     Running   0          32m
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>kube-scheduler-kube-test            1/1     Running   0          33m
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>weave-net-l8xkh                     2/2     Running   1          16m
</code></pre></div></p>
<h3 id="install-kuberntes-metrics-server">Install Kuberntes Metrics Server<a class="headerlink" href="#install-kuberntes-metrics-server" title="Permanent link">&para;</a></h3>
<p>In order to get basic performance information about our cluster or pods we have to install Kubernetes Metrics Server:</p>
<ul>
<li><a href="https://github.com/kubernetes-sigs/metrics-server">https://github.com/kubernetes-sigs/metrics-server</a></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
</code></pre></div>
<p>You probalby will get the following error:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>logs<span class="w"> </span>metrics-server-6775f684f6-gxpcz
</code></pre></div>
<p>Output: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>E1011 09:43:22.529064       1 scraper.go:139] &quot;Failed to scrape node&quot; err=&quot;Get \&quot;https://172.16.1.214:10250/stats/summary?only_cpu_and_memory=true\&quot;: x509: cannot validate certificate for 172.16.1.214 because it doesn&#39;t contain any IP SANs&quot; node=&quot;kube-test&quot;
</code></pre></div>
<p>Edit the deployment <code>kubectl -n kube-system edit  deployment metrics-server</code> and add this lint to <code>args</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">args</span><span class="p">:</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--kubelet-insecure-tls</span>
</code></pre></div>
<p><strong>Check</strong>
<div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>top<span class="w"> </span>pods
</code></pre></div>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>NAME                                CPU(cores)   MEMORY(bytes)   
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>coredns-558bd4d5db-l6gtq            3m           18Mi            
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>etcd-kube-test                      16m          41Mi            
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>kube-apiserver-kube-test            76m          333Mi           
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>kube-controller-manager-kube-test   12m          60Mi            
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>kube-proxy-nhm2h                    1m           20Mi            
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>kube-scheduler-kube-test            4m           25Mi            
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>metrics-server-6775f684f6-gxpcz     6m           18Mi            
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a>weave-net-l8xkh                     2m           61Mi
</code></pre></div></p>
<h3 id="install-nginx-ingress-controller">Install (Nginx) Ingress Controller<a class="headerlink" href="#install-nginx-ingress-controller" title="Permanent link">&para;</a></h3>
<p>Maybe this it the most interesting part of this article as for now. You can chose from various ingress controller to install. Check the official documentation for more details:</p>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/">https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/</a></li>
</ul>
<p>For this demo I choose the NGinx Ingress Controller. I think it is easy to install and maybe some of your already have experience with NGinx on bare metal. I can't tell you any other news than checking the official docs: <a href="https://kubernetes.github.io/ingress-nginx/deploy/">https://kubernetes.github.io/ingress-nginx/deploy/</a> </p>
<p>We are going to follow the Bare Metal installation: <a href="https://kubernetes.github.io/ingress-nginx/deploy/#bare-metal">https://kubernetes.github.io/ingress-nginx/deploy/#bare-metal</a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="c1"># Old version: kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.49.3/deploy/static/provider/baremetal/deploy.yaml</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.8.2/deploy/static/provider/cloud/deploy.yaml
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="c1"># Check The Install Process: </span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>ingress-nginx<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="w">  </span>-l<span class="w"> </span>app.kubernetes.io/name<span class="o">=</span>ingress-nginx<span class="w"> </span>--watch
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do NOT deploy the latest version (v1.0.3)! It won't work with hostNetwork on Bare Metal installation. The address field will be blank even if you specify <code>--report-node-internal-ip-address</code> command line arguments. I've tried a lot of settings but none of them worked.</p>
</div>
<p>Wait for this line:
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>ingress-nginx-controller-6c68f5b657-hvfn9   1/1     Running             0          60s
</code></pre></div></p>
<p>This is the default installation process. But at this point we have only NodePort service for incomming traffic:</p>
<p><div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>ingress-nginx<span class="w"> </span>get<span class="w"> </span>services
</code></pre></div>
<div class="highlight"><span class="filename">Ouptut</span><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>NAME                                 TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)                      AGE
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>ingress-nginx-controller             NodePort    10.22.0.78    &lt;none&gt;        80:30016/TCP,443:32242/TCP   104s
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>ingress-nginx-controller-admission   ClusterIP   10.22.0.242   &lt;none&gt;        443/TCP                      104s
</code></pre></div></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Please read very carefully this documentation: <a href="https://kubernetes.github.io/ingress-nginx/deploy/baremetal/">https://kubernetes.github.io/ingress-nginx/deploy/baremetal/</a></p>
</div>
<p>This NodePort means that our NGinx ingress controller is accessible on every node in the cluster on <code>30016/TCP</code> and <code>32242/TCP</code>. It is OK if you planning to use these ports to access the applications inside the cluster.<br />
Or you can install a reverse proxy somewehere in you physical network. This can be the Kubernetes host itself. Configuring a reverse proxy could be a pain, and it is not the subject of this article.</p>
<p><strong>Check</strong></p>
<p>To check the NGinx Ingress Controller you should use another machine in your network. Most of the time I use curl to check if web server is running or not, but you can use your browser instead.</p>
<p><div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>curl<span class="w"> </span>-i<span class="w"> </span>http://172.16.1.214:30016<span class="w"> </span>
</code></pre></div>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>HTTP/1.1 404 Not Found
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>Date: Mon, 11 Oct 2021 10:11:40 GMT
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>Content-Type: text/html
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>Content-Length: 146
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>Connection: keep-alive
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>&lt;html&gt;
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a>&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;
<a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a>&lt;body&gt;
<a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a>&lt;center&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;/center&gt;
<a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a>&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;
<a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a>&lt;/body&gt;
<a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a>&lt;/html&gt;
</code></pre></div></p>
<p><div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>curl<span class="w"> </span>-ik<span class="w"> </span>https://172.16.1.214:32242
</code></pre></div>
<div class="highlight"><span class="filename">Ouptut</span><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>HTTP/2 404 
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>date: Mon, 11 Oct 2021 10:12:13 GMT
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>content-type: text/html
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a>content-length: 146
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>strict-transport-security: max-age=15724800; includeSubDomains
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a>
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>&lt;html&gt;
<a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a>&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;
<a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a>&lt;body&gt;
<a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a>&lt;center&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;/center&gt;
<a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a>&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;
<a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a>&lt;/body&gt;
<a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a>&lt;/html&gt;
</code></pre></div></p>
<p>This is not the desired stat I want, I want to access my Ingresss Controller over the standard 80(http) and 443(https) ports, so choose the hostPort: <a href="https://kubernetes.github.io/ingress-nginx/deploy/baremetal/#via-the-host-network">https://kubernetes.github.io/ingress-nginx/deploy/baremetal/#via-the-host-network</a></p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>This setup absolutely not suitable for Production environment, but just enough for this demo.</p>
</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>kubectl<span class="w"> </span>patch<span class="w"> </span>deployment/ingress-nginx-controller<span class="w"> </span>-n<span class="w"> </span>ingress-nginx<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>-p<span class="w"> </span><span class="s1">&#39;{ &quot;spec&quot;: { &quot;template&quot;: { &quot;spec&quot;: { &quot;hostNetwork&quot;: true } } } }&#39;</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This command does't not effects the <code>Service</code>. If you want to check the config describe your pod with <code>kubectl -n ingress-nginx describe  $(kubectl -n ingress-nginx get pods -o name | grep  "ingress-nginx-controller")</code> command and look for this line <code>Host Ports:    80/TCP, 443/TCP, 8443/TCP</code></p>
</div>
<p><strong>Check</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-56-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-56-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-56-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-56-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-56-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-56-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-56-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-56-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-56-10">10</a></span>
<span class="normal"><a href="#__codelineno-56-11">11</a></span>
<span class="normal"><a href="#__codelineno-56-12">12</a></span>
<span class="normal"><a href="#__codelineno-56-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="hll">curl -ikI https://172.16.1.70
</span><a id="__codelineno-56-2" name="__codelineno-56-2"></a>HTTP/2 404 
<a id="__codelineno-56-3" name="__codelineno-56-3"></a>date: Mon, 11 Oct 2021 10:29:13 GMT
<a id="__codelineno-56-4" name="__codelineno-56-4"></a>content-type: text/html
<a id="__codelineno-56-5" name="__codelineno-56-5"></a>content-length: 146
<a id="__codelineno-56-6" name="__codelineno-56-6"></a>strict-transport-security: max-age=15724800; includeSubDomains
<a id="__codelineno-56-7" name="__codelineno-56-7"></a>
<a id="__codelineno-56-8" name="__codelineno-56-8"></a><span class="hll">curl -ikI http://172.16.1.70
</span><a id="__codelineno-56-9" name="__codelineno-56-9"></a>HTTP/1.1 404 Not Found
<a id="__codelineno-56-10" name="__codelineno-56-10"></a>Date: Mon, 11 Oct 2021 10:29:16 GMT
<a id="__codelineno-56-11" name="__codelineno-56-11"></a>Content-Type: text/html
<a id="__codelineno-56-12" name="__codelineno-56-12"></a>Content-Length: 146
<a id="__codelineno-56-13" name="__codelineno-56-13"></a>Connection: keep-alive
</code></pre></div></td></tr></table></div>
<h4 id="deploy-an-application-and-create-service-and-ingress-for-it">Deploy An Application And Create Service And Ingress For It<a class="headerlink" href="#deploy-an-application-and-create-service-and-ingress-for-it" title="Permanent link">&para;</a></h4>
<p>For demonstration we deploy a Ghost (blog) instance.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="c1"># kubectl create deployment ghost-test --image=ghost:latest</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>kubectl<span class="w"> </span>create<span class="w"> </span>deployment<span class="w"> </span>nginx-test<span class="w"> </span>--image<span class="o">=</span>nginx:latest
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Without explicitly specifying the namespace the pod will be created in the <code>default</code> namespace.</p>
</div>
<p>At this point we have a POD running, but we could not access it. First we need to create a <code>Service</code> object.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="c1">#kubectl create service clusterip ghost-test --tcp=2368:2368</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>kubectl<span class="w"> </span>create<span class="w"> </span>service<span class="w"> </span>clusterip<span class="w"> </span>nginx-test<span class="w"> </span>--tcp<span class="o">=</span><span class="m">80</span>:80
</code></pre></div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Use the same name as the Deployment (ghost-test)! This will create the appropiate selector.</p>
</div>
<p><strong>Check the Service:</strong></p>
<p><div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>svc<span class="w"> </span>nginx-test
</code></pre></div>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>Name:              nginx-test
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>Namespace:         default
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>Labels:            app=nginx-test
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>Annotations:       &lt;none&gt;
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a>Selector:          app=nginx-test
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a>Type:              ClusterIP
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a>IP Family Policy:  SingleStack
<a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a>IP Families:       IPv4
<a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a>IP:                10.22.103.28
<a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a>IPs:               10.22.103.28
<a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a>Port:              80-80  80/TCP
<a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a>TargetPort:        80/TCP
<a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a>Endpoints:         10.32.0.5:80
<a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a>Session Affinity:  None
<a id="__codelineno-60-15" name="__codelineno-60-15" href="#__codelineno-60-15"></a>Events:            &lt;none&gt;
</code></pre></div></p>
<p>The most important thing here is the Endpoints:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>Endpoints:          10.32.0.5:80
</code></pre></div>
<p>The IP address should point to the IP address of the Ghost POD:</p>
<p><div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-o<span class="w"> </span>wide
</code></pre></div>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>NAME                          READY   STATUS    RESTARTS   AGE   IP          NODE        NOMINATED NODE   READINESS GATES
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>nginx-test-5f4c58bccc-l5p9s   1/1     Running            0              82s     10.32.0.5   singlek8s   &lt;none&gt;           &lt;none&gt;
</code></pre></div></p>
<p><strong>The last step is to create the <code>Ingress</code> object.</strong></p>
<p>The <code>yaml</code> file:
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="l l-Scalar l-Scalar-Plain">cat &lt;&lt;EOF&gt;nginx-ingress.yaml</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-web</span>
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-test.example.local</span>
<a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a><span class="w">    </span><span class="nt">http</span><span class="p">:</span>
<a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a><span class="w">      </span><span class="nt">paths</span><span class="p">:</span>
<a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ImplementationSpecific</span>
<a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a><span class="w">        </span><span class="nt">backend</span><span class="p">:</span>
<a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a><span class="w">          </span><span class="nt">service</span><span class="p">:</span>
<a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-test</span>
<a id="__codelineno-64-17" name="__codelineno-64-17" href="#__codelineno-64-17"></a><span class="w">            </span><span class="nt">port</span><span class="p">:</span>
<a id="__codelineno-64-18" name="__codelineno-64-18" href="#__codelineno-64-18"></a><span class="w">              </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id="__codelineno-64-19" name="__codelineno-64-19" href="#__codelineno-64-19"></a><span class="l l-Scalar l-Scalar-Plain">EOF</span>
</code></pre></div></p>
<p>Apply the yaml:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>nginx-ingress.yaml
</code></pre></div>
<p><strong>Check the ingress</strong></p>
<p><div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>ingress<span class="w"> </span>nginx-web<span class="w"> </span>
</code></pre></div>
<div class="highlight"><span class="filename">Ouptut</span><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>Name:             nginx-web
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>Labels:           &lt;none&gt;
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>Namespace:        default
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>Address:
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a>Ingress Class:    nginx
<a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a>Default backend:  &lt;default&gt;
<a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>Rules:
<a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a>  Host                      Path  Backends
<a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a>  ----                      ----  --------
<a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a>  nginx-test.example.local
<a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a>                               nginx-test:80 (10.32.0.5:80)
<a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a>Annotations:                &lt;none&gt;
<a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a>Events:
<a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a>  Type    Reason  Age                    From                      Message
<a id="__codelineno-67-15" name="__codelineno-67-15" href="#__codelineno-67-15"></a>  ----    ------  ----                   ----                      -------
<a id="__codelineno-67-16" name="__codelineno-67-16" href="#__codelineno-67-16"></a>  Normal  Sync    2m26s (x3 over 4m19s)  nginx-ingress-controller  Scheduled for sync
</code></pre></div></p>
<p><strong>Check With <code>curl</code></strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>curl<span class="w">  </span>-H<span class="w">  </span><span class="s1">&#39;Host: nginx-test.example.local&#39;</span><span class="w"> </span>http://172.16.1.70
</code></pre></div>
<h4 id="dns-entries">DNS Entries<a class="headerlink" href="#dns-entries" title="Permanent link">&para;</a></h4>
<p>The above example works only if you overwrite the HTTP Host header with <code>'Host: ghost-test.example.local'</code>. This is because the <code>ghost-test.example.local</code> domain name does not exist. At this point we have to decide how to manage the DNS. The Kubernetes Igress works the best if we have a wildcard DNS entry. I don't want to get deep insude the DNS problem, but give you some tips:</p>
<ul>
<li>If your home router support static DNS entries you can define one, for example: <code>*.k8s.test.local</code>. My <strong>Mikrotik</strong> router has this function, so I can easily create a local wildcard DNS. Example <code>/ip dns static add address=172.16.1.214 regexp=.k8s-test.loc</code></li>
<li>You can use your existing domain, or buy a new one. For example I have vinczejanos.info domain registered at Godaddy. I can add a wildcard DNS record which points to the IP address of the Kubernetes machine. (<code>*.local.k8s.vinczejanos.info</code>) Be aware that this can be a security risk, everybody on the public Internet can resolve this host name, and it points to a private IP address.</li>
<li>You can set up your own DNS server. Maybe the easiest way is the DNSMasq, but Bind9 can be also a good alternative. (Bind maybe a bit robust for this purpose.) In this case you have to configure all of your clients to use the new DNS server. </li>
<li>Since this is only a demo environment, a suitable solution can be to use your <code>hosts</code> file, but keep in mind that hosts file doesn't support wildcards, so you have to specify all host names one-by-one. The hosts file must be updated on all the host from where you want to access your Kubernetes Cluster.</li>
</ul>
<details class="example">
<summary>Example</summary>
<p>Hosts file location:</p>
<ul>
<li>Linux: <code>/etc/hosts</code></li>
<li>Windows: <code>Windows\System32\drivers\etc</code>  </li>
</ul>
</details>
<p>Now, we have a fully functional Single Node Kubernetes Cluster. </p>
<h2 id="install-kubernetes-dashboard">Install Kubernetes Dashboard<a class="headerlink" href="#install-kubernetes-dashboard" title="Permanent link">&para;</a></h2>
<p>Link: <a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/</a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="c1">#kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.3.1/aio/deploy/recommended.yaml</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/kubernetes/dashboard/v3.0.0-alpha0/charts/kubernetes-dashboard.yaml
</code></pre></div>
<p>Check if the pods are fine.</p>
<p><div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>kubernetes-dashboard<span class="w"> </span>get<span class="w"> </span>pods
</code></pre></div>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>NAME                                                    READY   STATUS    RESTARTS   AGE
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>kubernetes-dashboard-api-8586787f7-hmhmn                1/1     Running   0          35s
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>kubernetes-dashboard-metrics-scraper-6959b784dc-669wh   1/1     Running   0          35s
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>kubernetes-dashboard-web-6b6d549b4-8bwhm                1/1     Running   0          35s
</code></pre></div></p>
<h3 id="create-an-ingress">Create An Ingress<a class="headerlink" href="#create-an-ingress" title="Permanent link">&para;</a></h3>
<p><strong>Check The Service</strong></p>
<p><div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>kubernetes-dashboard<span class="w"> </span>describe<span class="w">  </span>svc<span class="w"> </span>kubernetes-dashboard
</code></pre></div>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>Name:              kubernetes-dashboard-web
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>Namespace:         kubernetes-dashboard
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>Labels:            app.kubernetes.io/component=web
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a>                   app.kubernetes.io/name=kubernetes-dashboard-web
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a>                   app.kubernetes.io/part-of=kubernetes-dashboard
<a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a>                   app.kubernetes.io/version=v1.0.0
<a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a>Annotations:       &lt;none&gt;
<a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a>Selector:          app.kubernetes.io/name=kubernetes-dashboard-web,app.kubernetes.io/part-of=kubernetes-dashboard
<a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a>Type:              ClusterIP
<a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a>IP Family Policy:  SingleStack
<a id="__codelineno-73-11" name="__codelineno-73-11" href="#__codelineno-73-11"></a>IP Families:       IPv4
<a id="__codelineno-73-12" name="__codelineno-73-12" href="#__codelineno-73-12"></a>IP:                10.22.216.140
<a id="__codelineno-73-13" name="__codelineno-73-13" href="#__codelineno-73-13"></a>IPs:               10.22.216.140
<a id="__codelineno-73-14" name="__codelineno-73-14" href="#__codelineno-73-14"></a>Port:              web  8000/TCP
<a id="__codelineno-73-15" name="__codelineno-73-15" href="#__codelineno-73-15"></a>TargetPort:        8000/TCP
<a id="__codelineno-73-16" name="__codelineno-73-16" href="#__codelineno-73-16"></a>Endpoints:         10.32.0.7:8000
<a id="__codelineno-73-17" name="__codelineno-73-17" href="#__codelineno-73-17"></a>Session Affinity:  None
<a id="__codelineno-73-18" name="__codelineno-73-18" href="#__codelineno-73-18"></a>Events:            &lt;none&gt;
</code></pre></div></p>
<p><strong>The Ingress <code>yaml</code></strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="l l-Scalar l-Scalar-Plain">cat &lt;&lt;EOF&gt;kubernetes-dashboard-ingress.yaml</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard-v3</span>
<a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
<a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-ingress</span>
<a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
<a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a><span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a><span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
<a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span>
<a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s-dashboard.vincze.work</span>
<a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a><span class="w">      </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s-dashboardv3-certs</span>
<a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dashboard.k8s-test.loc</span>
<a id="__codelineno-74-19" name="__codelineno-74-19" href="#__codelineno-74-19"></a><span class="w">      </span><span class="nt">http</span><span class="p">:</span>
<a id="__codelineno-74-20" name="__codelineno-74-20" href="#__codelineno-74-20"></a><span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
<a id="__codelineno-74-21" name="__codelineno-74-21" href="#__codelineno-74-21"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<a id="__codelineno-74-22" name="__codelineno-74-22" href="#__codelineno-74-22"></a><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<a id="__codelineno-74-23" name="__codelineno-74-23" href="#__codelineno-74-23"></a><span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<a id="__codelineno-74-24" name="__codelineno-74-24" href="#__codelineno-74-24"></a><span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<a id="__codelineno-74-25" name="__codelineno-74-25" href="#__codelineno-74-25"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard-web</span>
<a id="__codelineno-74-26" name="__codelineno-74-26" href="#__codelineno-74-26"></a><span class="w">                </span><span class="nt">port</span><span class="p">:</span>
<a id="__codelineno-74-27" name="__codelineno-74-27" href="#__codelineno-74-27"></a><span class="w">                  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
<a id="__codelineno-74-28" name="__codelineno-74-28" href="#__codelineno-74-28"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/api</span>
<a id="__codelineno-74-29" name="__codelineno-74-29" href="#__codelineno-74-29"></a><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<a id="__codelineno-74-30" name="__codelineno-74-30" href="#__codelineno-74-30"></a><span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
<a id="__codelineno-74-31" name="__codelineno-74-31" href="#__codelineno-74-31"></a><span class="w">              </span><span class="nt">service</span><span class="p">:</span>
<a id="__codelineno-74-32" name="__codelineno-74-32" href="#__codelineno-74-32"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard-api</span>
<a id="__codelineno-74-33" name="__codelineno-74-33" href="#__codelineno-74-33"></a><span class="w">                </span><span class="nt">port</span><span class="p">:</span>
<a id="__codelineno-74-34" name="__codelineno-74-34" href="#__codelineno-74-34"></a><span class="w">                  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
<a id="__codelineno-74-35" name="__codelineno-74-35" href="#__codelineno-74-35"></a><span class="l l-Scalar l-Scalar-Plain">EOF</span>
</code></pre></div>
<p>Apply the ingress:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>kubernetes-dashboard-ingress.yaml
</code></pre></div>
<p>Now I can access the Kubernetes Dashboard at <a href="https://dashboard.k8s-test.loc">https://dashboard.k8s-test.loc</a></p>
<h3 id="the-token">The Token<a class="headerlink" href="#the-token" title="Permanent link">&para;</a></h3>
<p>When you see the login screen, you are asked for the token or kubeconfig file. I choose the simpier way and use token.</p>
<p><strong>Create the token:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>-<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="s">apiVersion: v1</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="s">kind: Secret</span>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="s">metadata:</span>
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="s">  name: kubernetes-dashboard-token</span>
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="s">  namespace: kubernetes-dashboard</span>
<a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a><span class="s">  annotations:</span>
<a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a><span class="s">    kubernetes.io/service-account.name: kubernetes-dashboard</span>
<a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a><span class="s">type: kubernetes.io/service-account-token</span>
<a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a><span class="s">EOF</span>
</code></pre></div>
<p><strong>Get The Token</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>kubernetes-dashboard<span class="w"> </span>get<span class="w"> </span>secret/kubernetes-dashboard-token<span class="w"> </span>-o<span class="w"> </span>json<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.data.token&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="w"> </span><span class="p">;</span><span class="nb">echo</span>
</code></pre></div></p>
<h3 id="fix-permission">Fix Permission<a class="headerlink" href="#fix-permission" title="Permanent link">&para;</a></h3>
<p>You will see a lot of error message like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a>namespaces is forbidden: User &quot;system:serviceaccount:kubernetes-dashboard:kubernetes-dashboard&quot; cannot list resource &quot;namespaces&quot; in API group &quot;&quot; at the cluster scope
</code></pre></div>
<p><strong>Screenshot:</strong></p>
<p><img alt="Error" src="/assets/images/DeepinScreenshot_select-area_20211011165036.png" /></p>
<p>I don't want to bother with roles and rolebindigns at this article. I want quick win, so edit the <code>kubernetes-dashboard</code> ClusterRole.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a>kubectl<span class="w">  </span>edit<span class="w">  </span>clusterrole<span class="w"> </span>kubernetes-dashboard
</code></pre></div>
<p>And modify:
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="w"> </span>rules:
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="w"> </span>- apiGroups:
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="gd">-  - metrics.k8s.io</span>
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a><span class="gi">+  - &#39;*&#39;</span>
<a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a><span class="w"> </span>  resources:
<a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a><span class="gd">-  - pods</span>
<a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a><span class="gd">-  - nodes</span>
<a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a><span class="gi">+  - &#39;*&#39;</span>
<a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a><span class="w"> </span>  verbs:
<a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a><span class="gd">-  - get</span>
<a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a><span class="gd">-  - list</span>
<a id="__codelineno-80-12" name="__codelineno-80-12" href="#__codelineno-80-12"></a><span class="gd">-  - watch</span>
<a id="__codelineno-80-13" name="__codelineno-80-13" href="#__codelineno-80-13"></a><span class="gi">+  - &#39;*&#39;</span>
<a id="__codelineno-80-14" name="__codelineno-80-14" href="#__codelineno-80-14"></a><span class="gi">+- nonResourceURLs:</span>
<a id="__codelineno-80-15" name="__codelineno-80-15" href="#__codelineno-80-15"></a><span class="gi">+  - &#39;*&#39;</span>
<a id="__codelineno-80-16" name="__codelineno-80-16" href="#__codelineno-80-16"></a><span class="gi">+  verbs:</span>
<a id="__codelineno-80-17" name="__codelineno-80-17" href="#__codelineno-80-17"></a><span class="gi">+  - &#39;*&#39;</span>
</code></pre></div></p>
<p>It should look like this (<code>kubectl  get clusterrole kubernetes-dashboard -o yaml</code>):
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="w">    </span><span class="nt">kubectl.kubernetes.io/last-applied-configuration</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="w">      </span><span class="no">{&quot;apiVersion&quot;:&quot;rbac.authorization.k8s.io/v1&quot;,&quot;kind&quot;:&quot;ClusterRole&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;labels&quot;:{&quot;k8s-app&quot;:&quot;kubernetes-dashboard&quot;},&quot;name&quot;:&quot;kubernetes-dashboard&quot;},&quot;rules&quot;:[{&quot;apiGroups&quot;:[&quot;metrics.k8s.io&quot;],&quot;resources&quot;:[&quot;pods&quot;,&quot;nodes&quot;],&quot;verbs&quot;:[&quot;get&quot;,&quot;list&quot;,&quot;watch&quot;]}]}</span>
<a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a><span class="w">  </span><span class="nt">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2021-10-11T14:33:17Z&quot;</span>
<a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a><span class="w">    </span><span class="nt">k8s-app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
<a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
<a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a><span class="w">  </span><span class="nt">resourceVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;15040&quot;</span>
<a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a><span class="w">  </span><span class="nt">uid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">26495412-c50f-48fb-b3ce-448d42dff15b</span>
<a id="__codelineno-81-13" name="__codelineno-81-13" href="#__codelineno-81-13"></a><span class="nt">rules</span><span class="p">:</span>
<a id="__codelineno-81-14" name="__codelineno-81-14" href="#__codelineno-81-14"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span>
<a id="__codelineno-81-15" name="__codelineno-81-15" href="#__codelineno-81-15"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;*&#39;</span>
<a id="__codelineno-81-16" name="__codelineno-81-16" href="#__codelineno-81-16"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-81-17" name="__codelineno-81-17" href="#__codelineno-81-17"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;*&#39;</span>
<a id="__codelineno-81-18" name="__codelineno-81-18" href="#__codelineno-81-18"></a><span class="w">  </span><span class="nt">verbs</span><span class="p">:</span>
<a id="__codelineno-81-19" name="__codelineno-81-19" href="#__codelineno-81-19"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;*&#39;</span>
<a id="__codelineno-81-20" name="__codelineno-81-20" href="#__codelineno-81-20"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">nonResourceURLs</span><span class="p">:</span>
<a id="__codelineno-81-21" name="__codelineno-81-21" href="#__codelineno-81-21"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;*&#39;</span>
<a id="__codelineno-81-22" name="__codelineno-81-22" href="#__codelineno-81-22"></a><span class="w">  </span><span class="nt">verbs</span><span class="p">:</span>
<a id="__codelineno-81-23" name="__codelineno-81-23" href="#__codelineno-81-23"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;*&#39;</span>
</code></pre></div></p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Do NOT do this in Production system! This way you give cluster-admin role to kubernetes-dashboard ServiceAccount. Everybody who knows the token can do anything with your Kubernetes cluster!</p>
</div>
<h2 id="cheatsheet">CheatSheet<a class="headerlink" href="#cheatsheet" title="Permanent link">&para;</a></h2>
<p>Finally I write here some command I'm using in daily basis.</p>
<h4 id="list-and-delete-completed-pods">List And Delete <code>Completed</code> PODS<a class="headerlink" href="#list-and-delete-completed-pods" title="Permanent link">&para;</a></h4>
<p>When a Job finishes it's work, the container is left as <code>Completed</code>. A lot of PODS in <code>Completed</code> statw can be disturbing, and they can be safely deleted.</p>
<p>List: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>--all-namespaces<span class="w"> </span>--field-selector<span class="o">=</span>status.phase<span class="o">=</span>Succeeded
</code></pre></div>
<p>Delete:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>pods<span class="w"> </span>--all-namespaces<span class="w"> </span>--field-selector<span class="o">=</span>status.phase<span class="o">=</span>Succeeded
</code></pre></div>
<h4 id="check-container-logs">Check Container Logs<a class="headerlink" href="#check-container-logs" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="c1"># List PODS</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>default<span class="w"> </span>get<span class="w"> </span>pods
<a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a>
<a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="c1"># Show the logs:</span>
<a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>default<span class="w"> </span>logs<span class="w"> </span>ghost-test-66846549b5-qgcl8
<a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a>
<a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="c1"># Or follow the logs:</span>
<a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>default<span class="w"> </span>logs<span class="w"> </span>ghost-test-66846549b5-qgcl8<span class="w"> </span>-f
<a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a>
<a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a><span class="c1"># Or follow without showing only the logs written from now.</span>
<a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>default<span class="w"> </span>logs<span class="w"> </span>ghost-test-66846549b5-qgcl8<span class="w"> </span>-f<span class="w"> </span>--tail<span class="o">=</span><span class="m">0</span>
</code></pre></div>
<h4 id="get-into-the-container">Get Into The Container<a class="headerlink" href="#get-into-the-container" title="Permanent link">&para;</a></h4>
<p>Sometimes you need to see what happens inside a container. In this case you can get a shell inside the container.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>default<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>ghost-test-66846549b5-qgcl8<span class="w"> </span>--<span class="w"> </span>/bin/bash
<a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a>
<a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="c1"># Or if no bash installed, you can try sh</span>
<a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>default<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>ghost-test-66846549b5-qgcl8<span class="w"> </span>--<span class="w"> </span>/bin/sh
</code></pre></div>
<h4 id="pending-pods-nginx-ingress">Pending PODS (nginx ingress)<a class="headerlink" href="#pending-pods-nginx-ingress" title="Permanent link">&para;</a></h4>
<p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a>NAME                                        READY   STATUS    RESTARTS   AGE
<a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a>ingress-nginx-controller-5f7bb7476d-2nhqc   0/1     Pending   0          4s
<a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a>ingress-nginx-controller-745c7c9f6c-m9q5q   1/1     Running   2          128m
</code></pre></div></p>
<p>Events:
<div class="highlight"><span class="filename">Command</span><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>ingress-nginx<span class="w"> </span>get<span class="w"> </span>events
</code></pre></div>
<div class="highlight"><span class="filename">Output</span><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a>LAST SEEN   TYPE      REASON              OBJECT                                           MESSAGE
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>34s         Warning   FailedScheduling    pod/ingress-nginx-controller-5f7bb7476d-2nhqc    0/1 nodes are available: 1 node(s) didn&#39;t have free ports for the requested pod ports.
<a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a>35s         Normal    SuccessfulCreate    replicaset/ingress-nginx-controller-5f7bb7476d   Created pod: ingress-nginx-controller-5f7bb7476d-2nhqc
<a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a>36s         Normal    ScalingReplicaSet   deployment/ingress-nginx-controller              Scaled up replica set ingress-nginx-controller-5f7bb7476d to 1
</code></pre></div></p>
<p>The problem: <code>0/1 nodes are available: 1 node(s) didn't have free ports for the requested pod ports.</code></p>
<p>NGinx Ingress Controller (the POD) uses hostPort, and RollingUpdate strategy. This means that Kubernetes tries to start a new instance, and after the new instance is Running and healthy stop the "old" one. But in this case it is not possible because two container can not bind the same ports (80,443). </p>
<p>The easiest way to solve this is to delete the old pod manually. ( <code>ingress-nginx-controller-745c7c9f6c-m9q5q</code> )</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>ingress-nginx<span class="w"> </span>delete<span class="w"> </span>pod<span class="w"> </span>ingress-nginx-controller-745c7c9f6c-m9q5q
</code></pre></div>
<p>Permanent solution could be changing the strategy to ReCreate.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a>kubectl<span class="w"> </span>patch<span class="w"> </span>deployment/ingress-nginx-controller<span class="w"> </span>-n<span class="w"> </span>ingress-nginx<span class="w">  </span>-p<span class="w"> </span><span class="s1">&#39;{ &quot;spec&quot;: { &quot;strategy&quot;:{ &quot;$retainKeys&quot;: [&quot;type&quot;],&quot;type&quot;: &quot;Recreate&quot;}}}&#39;</span>
</code></pre></div>
<p>Show pretty print Json
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="p">{</span>
<a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="w">  </span><span class="nt">&quot;spec&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="w">    </span><span class="nt">&quot;strategy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="w">      </span><span class="nt">&quot;$retainKeys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="w">        </span><span class="s2">&quot;type&quot;</span>
<a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a><span class="w">      </span><span class="p">],</span>
<a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Recreate&quot;</span>
<a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-91-10" name="__codelineno-91-10" href="#__codelineno-91-10"></a><span class="p">}</span>
</code></pre></div></p>
<p>Reference: </p>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/manage-kubernetes-objects/update-api-object-kubectl-patch/#use-strategic-merge-patch-to-update-a-deployment-using-the-retainkeys-strategy">Use strategic merge patch to update a Deployment using the retainKeys strategy</a></li>
<li><a href="https://blog.container-solutions.com/kubernetes-deployment-strategies">https://blog.container-solutions.com/kubernetes-deployment-strategies</a></li>
</ul>
<h4 id="get-all-all-namespaces">Get All / All Namespaces<a class="headerlink" href="#get-all-all-namespaces" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>ingress-nginx<span class="w"> </span>get<span class="w"> </span>all
<a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>
<a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="c1"># Get all ingress in the cluster</span>
<a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a>
<a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a>kubectl<span class="w"> </span>get<span class="w"> </span>ingress<span class="w"> </span>--all-namespaces<span class="w"> </span>-o<span class="w"> </span>wide
</code></pre></div>
<h4 id="print-join-command-add-worker-node">Print Join Command (Add Worker Node)<a class="headerlink" href="#print-join-command-add-worker-node" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a>kubeadm<span class="w"> </span>token<span class="w"> </span>create<span class="w"> </span>--print-join-command
</code></pre></div>
<h4 id="get-all-resources-get-help">Get All Resources / Get Help<a class="headerlink" href="#get-all-resources-get-help" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a>kubectl<span class="w"> </span>api-resources
<a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>
<a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="c1"># Explain</span>
<a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a>
<a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a>kubectl<span class="w"> </span>explain<span class="w"> </span>pod
<a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a>kubectl<span class="w"> </span>explain<span class="w"> </span>pod.spec
<a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a>kubectl<span class="w"> </span>explain<span class="w"> </span>pod.spec.tolerations
</code></pre></div>
<h4 id="copy-dir-file-from-container">Copy Dir / File From Container<a class="headerlink" href="#copy-dir-file-from-container" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="c1"># File </span>
<a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a>
<a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>default<span class="w"> </span>cp<span class="w"> </span>ghost-test-66846549b5-qgcl8:/var/lib/ghost/config.production.json<span class="w">  </span>config.production.json
<a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a>
<a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="c1"># Directory</span>
<a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>default<span class="w"> </span>cp<span class="w"> </span>ghost-test-66846549b5-qgcl8:/var/lib/ghost<span class="w"> </span>.
</code></pre></div>
<details class="warning">
<summary>Warning</summary>
<p><code>kubectl -n default cp ghost-test-66846549b5-qgcl8:/var/lib/ghost .</code> &lt;-- This will copy the conents of the directory. If you want to create the 'ghost' directory on the destination use: </p>
<p><code>kubectl -n default cp ghost-test-66846549b5-qgcl8:/var/lib/ghost ghost</code></p>
</details>







  
  




  


<script src="https://giscus.app/client.js"
        data-repo="jvincze84/jvincze84.github.io"
        data-repo-id="R_kgDOGJolJg"
        data-category-id="DIC_kwDOGJolJs4CPryr"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="transparent_dark"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <!-- Cookie Consent by https://www.CookieConsent.com -->
<script type="text/javascript" src="//www.cookieconsent.com/releases/4.0.0/cookie-consent.js" charset="UTF-8"></script>
<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({"notice_banner_type":"headline","consent_type":"express","palette":"light","language":"en","page_load_consent_levels":["strictly-necessary"],"notice_banner_reject_button_hide":false,"preferences_center_close_button_hide":false,"website_name":"Blog"});
});
</script>

<noscript>ePrivacy and GPDR Cookie Consent by <a href="https://www.CookieConsent.com/" rel="nofollow noopener">Cookie Consent</a></noscript>
<!-- End Cookie Consent by https://www.CookieConsent.com -->

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../../..", "features": ["navigation.indexes", "navigation.top", "search.suggest", "search.highlight", "search.highlight", "header.autohide", "content.code.annotate", "content.code.copy"], "search": "../../../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>