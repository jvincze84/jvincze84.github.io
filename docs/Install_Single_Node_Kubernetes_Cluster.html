<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>body {
  max-width: 980px;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 45px;
}

@font-face {
  font-family: fontawesome-mini;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body b,
.markdown-body strong {
  font-weight: bold;
}

.markdown-body mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

.markdown-body sub,
.markdown-body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.markdown-body sup {
  top: -0.5em;
}
.markdown-body sub {
  bottom: -0.25em;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre,
.markdown-body samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body .codehilitetable,
.markdown-body .highlighttable {
  border: 0;
  border-spacing: 0;
}

.markdown-body .codehilitetable tr,
.markdown-body .highlighttable {
  border: 0;
}

.markdown-body .codehilitetable pre,
.markdown-body .codehilitetable div.codehilite,
.markdown-body .highlighttable pre,
.markdown-body .highlighttable div.highlight {
  margin: 0;
}

.markdown-body .linenos,
.markdown-body .code,
.markdown-body .codehilitetable td,
.markdown-body .highlighttable td {
  border: 0;
  padding: 0;
}

.markdown-body td:not(.linenos) .linenodiv {
  padding: 0 !important;
}

.markdown-body .code {
  width: 100%;
}

.markdown-body .linenos div pre,
.markdown-body .linenodiv pre,
.markdown-body .linenodiv {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  -moz-border-radius-topleft: 3px;
  -moz-border-radius-bottomleft: 3px;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 3px;
}

.markdown-body .code div pre,
.markdown-body .code div {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-right-radius: 3px;
  -webkit-border-bottom-right-radius: 3px;
  -moz-border-radius-topright: 3px;
  -moz-border-radius-bottomright: 3px;
  border-top-right-radius: 3px;
  border-bottom-right-radius: 3px;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre,
.markdown-body samp {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .headerlink {
  font: normal 400 16px fontawesome-mini;
  vertical-align: middle;
  margin-left: -16px;
  float: left;
  display: inline-block;
  text-decoration: none;
  opacity: 0;
  color: #333;
}

.markdown-body .headerlink:focus {
  outline: none;
}

.markdown-body h1 .headerlink {
  margin-top: 0.8rem;
}

.markdown-body h2 .headerlink,
.markdown-body h3 .headerlink {
  margin-top: 0.6rem;
}

.markdown-body h4 .headerlink {
  margin-top: 0.2rem;
}

.markdown-body h5 .headerlink,
.markdown-body h6 .headerlink {
  margin-top: 0;
}

.markdown-body .headerlink:hover,
.markdown-body h1:hover .headerlink,
.markdown-body h2:hover .headerlink,
.markdown-body h3:hover .headerlink,
.markdown-body h4:hover .headerlink,
.markdown-body h5:hover .headerlink,
.markdown-body h6:hover .headerlink {
  opacity: 1;
  text-decoration: none;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre,
.markdown-body .admonition {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code,
.markdown-body samp {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .codehilite,
.markdown-body .highlight {
  margin-bottom: 16px;
}

.markdown-body .codehilite pre,
.markdown-body .highlight pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .codehilite pre,
.markdown-body .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

/* Admonition */
.markdown-body .admonition {
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  position: relative;
  border-radius: 3px;
  border: 1px solid #e0e0e0;
  border-left: 6px solid #333;
  padding: 10px 10px 10px 30px;
}

.markdown-body .admonition table {
  color: #333;
}

.markdown-body .admonition p {
  padding: 0;
}

.markdown-body .admonition-title {
  font-weight: bold;
  margin: 0;
}

.markdown-body .admonition>.admonition-title {
  color: #333;
}

.markdown-body .attention>.admonition-title {
  color: #a6d796;
}

.markdown-body .caution>.admonition-title {
  color: #d7a796;
}

.markdown-body .hint>.admonition-title {
  color: #96c6d7;
}

.markdown-body .danger>.admonition-title {
  color: #c25f77;
}

.markdown-body .question>.admonition-title {
  color: #96a6d7;
}

.markdown-body .note>.admonition-title {
  color: #d7c896;
}

.markdown-body .admonition:before,
.markdown-body .attention:before,
.markdown-body .caution:before,
.markdown-body .hint:before,
.markdown-body .danger:before,
.markdown-body .question:before,
.markdown-body .note:before {
  font: normal normal 16px fontawesome-mini;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 1.5;
  color: #333;
  position: absolute;
  left: 0;
  top: 0;
  padding-top: 10px;
  padding-left: 10px;
}

.markdown-body .admonition:before {
  content: "\f056\00a0";
  color: 333;
}

.markdown-body .attention:before {
  content: "\f058\00a0";
  color: #a6d796;
}

.markdown-body .caution:before {
  content: "\f06a\00a0";
  color: #d7a796;
}

.markdown-body .hint:before {
  content: "\f05a\00a0";
  color: #96c6d7;
}

.markdown-body .danger:before {
  content: "\f057\00a0";
  color: #c25f77;
}

.markdown-body .question:before {
  content: "\f059\00a0";
  color: #96a6d7;
}

.markdown-body .note:before {
  content: "\f040\00a0";
  color: #d7c896;
}

.markdown-body .admonition::after {
  content: normal;
}

.markdown-body .attention {
  border-left: 6px solid #a6d796;
}

.markdown-body .caution {
  border-left: 6px solid #d7a796;
}

.markdown-body .hint {
  border-left: 6px solid #96c6d7;
}

.markdown-body .danger {
  border-left: 6px solid #c25f77;
}

.markdown-body .question {
  border-left: 6px solid #96a6d7;
}

.markdown-body .note {
  border-left: 6px solid #d7c896;
}

.markdown-body .admonition>*:first-child {
  margin-top: 0 !important;
}

.markdown-body .admonition>*:last-child {
  margin-bottom: 0 !important;
}

/* progress bar*/
.markdown-body .progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #ededed;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.markdown-body .progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.markdown-body .progress-bar {
  height: 24px;
  float: left;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #96c6d7;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);
  background-size: 30px 30px;
  background-image: -webkit-linear-gradient(
    135deg, rgba(255, 255, 255, .4) 27%,
    transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%,
    transparent 77%, transparent
  );
  background-image: -moz-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -ms-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -o-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
}

.markdown-body .progress-100plus .progress-bar {
  background-color: #a6d796;
}

.markdown-body .progress-80plus .progress-bar {
  background-color: #c6d796;
}

.markdown-body .progress-60plus .progress-bar {
  background-color: #d7c896;
}

.markdown-body .progress-40plus .progress-bar {
  background-color: #d7a796;
}

.markdown-body .progress-20plus .progress-bar {
  background-color: #d796a6;
}

.markdown-body .progress-0plus .progress-bar {
  background-color: #c25f77;
}

.markdown-body .candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

.markdown-body .gloss .progress-bar {
  box-shadow:
    inset 0 4px 12px rgba(255, 255, 255, .7),
    inset 0 -12px 0 rgba(0, 0, 0, .05);
}

/* MultiMarkdown Critic Blocks */
.markdown-body .critic_mark {
  background: #ff0;
}

.markdown-body .critic_delete {
  color: #c82829;
  text-decoration: line-through;
}

.markdown-body .critic_insert {
  color: #718c00 ;
  text-decoration: underline;
}

.markdown-body .critic_comment {
  color: #8e908c;
  font-style: italic;
}

.markdown-body .headeranchor {
  font: normal normal 16px fontawesome-mini;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.headeranchor:before {
  content: '\e157';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}

/* Media */
@media only screen and (min-width: 480px) {
  .markdown-body {
    font-size:14px;
  }
}

@media only screen and (min-width: 768px) {
  .markdown-body {
    font-size:16px;
  }
}

@media print {
  .markdown-body * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
    -ms-filter: none !important;
  }

  .markdown-body {
    font-size:12pt;
    max-width:100%;
    outline:none;
    border: 0;
  }

  .markdown-body a,
  .markdown-body a:visited {
    text-decoration: underline;
  }

  .markdown-body .headeranchor-link {
    display: none;
  }

  .markdown-body a[href]:after {
    content: " (" attr(href) ")";
  }

  .markdown-body abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .markdown-body .ir a:after,
  .markdown-body a[href^="javascript:"]:after,
  .markdown-body a[href^="#"]:after {
    content: "";
  }

  .markdown-body pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .markdown-body pre,
  .markdown-body blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  .markdown-body .progress,
  .markdown-body .progress-bar {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .markdown-body .progress {
    border: 1px solid #ddd;
  }

  .markdown-body .progress-bar {
    height: 22px;
    border-right: 1px solid #ddd;
  }

  .markdown-body tr,
  .markdown-body img {
    page-break-inside: avoid;
  }

  .markdown-body img {
    max-width: 100% !important;
  }

  .markdown-body p,
  .markdown-body h2,
  .markdown-body h3 {
    orphans: 3;
    widows: 3;
  }

  .markdown-body h2,
  .markdown-body h3 {
    page-break-after: avoid;
  }
}
</style><style>/*GitHub*/
.highlight {background-color:#fff;color:#333333;}
.highlight .hll {background-color:#ffffcc;}
.highlight .c{color:#999988;font-style:italic}
.highlight .err{color:#a61717;background-color:#e3d2d2}
.highlight .k{font-weight:bold}
.highlight .o{font-weight:bold}
.highlight .cm{color:#999988;font-style:italic}
.highlight .cp{color:#999999;font-weight:bold}
.highlight .c1{color:#999988;font-style:italic}
.highlight .cs{color:#999999;font-weight:bold;font-style:italic}
.highlight .gd{color:#000000;background-color:#ffdddd}
.highlight .ge{font-style:italic}
.highlight .gr{color:#aa0000}
.highlight .gh{color:#999999}
.highlight .gi{color:#000000;background-color:#ddffdd}
.highlight .go{color:#888888}
.highlight .gp{color:#555555}
.highlight .gs{font-weight:bold}
.highlight .gu{color:#800080;font-weight:bold}
.highlight .gt{color:#aa0000}
.highlight .kc{font-weight:bold}
.highlight .kd{font-weight:bold}
.highlight .kn{font-weight:bold}
.highlight .kp{font-weight:bold}
.highlight .kr{font-weight:bold}
.highlight .kt{color:#445588;font-weight:bold}
.highlight .m{color:#009999}
.highlight .s{color:#dd1144}
.highlight .n{color:#333333}
.highlight .na{color:teal}
.highlight .nb{color:#0086b3}
.highlight .nc{color:#445588;font-weight:bold}
.highlight .no{color:teal}
.highlight .ni{color:purple}
.highlight .ne{color:#990000;font-weight:bold}
.highlight .nf{color:#990000;font-weight:bold}
.highlight .nn{color:#555555}
.highlight .nt{color:navy}
.highlight .nv{color:teal}
.highlight .ow{font-weight:bold}
.highlight .w{color:#bbbbbb}
.highlight .mf{color:#009999}
.highlight .mh{color:#009999}
.highlight .mi{color:#009999}
.highlight .mo{color:#009999}
.highlight .sb{color:#dd1144}
.highlight .sc{color:#dd1144}
.highlight .sd{color:#dd1144}
.highlight .s2{color:#dd1144}
.highlight .se{color:#dd1144}
.highlight .sh{color:#dd1144}
.highlight .si{color:#dd1144}
.highlight .sx{color:#dd1144}
.highlight .sr{color:#009926}
.highlight .s1{color:#dd1144}
.highlight .ss{color:#990073}
.highlight .bp{color:#999999}
.highlight .vc{color:teal}
.highlight .vg{color:teal}
.highlight .vi{color:teal}
.highlight .il{color:#009999}
.highlight .gc{color:#999;background-color:#EAF2F5}
</style><title>Install_Single_Node_Kubernetes_Cluster</title></head><body><article class="markdown-body"><h1 id="install-a-single-node-kubernetes-cluster">Install A Single Node Kubernetes &ldquo;Cluster&rdquo;<a class="headerlink" href="#install-a-single-node-kubernetes-cluster" title="Permanent link"></a></h1>
<p>In this article we will install a single node kubernetes cluster on Debian 11 (bullseye). I will walk through step by step all the commands and configurations.</p>
<h2 id="prerequisite">Prerequisite<a class="headerlink" href="#prerequisite" title="Permanent link"></a></h2>
<p>I&rsquo;m using a really old system for this demonstration:</p>
<ul>
<li>CPU: Intel(R) Core(TM)2 CPU 6400  @ 2.13GHz (Dell Optiplex 745)</li>
<li>Mem: 4 GB</li>
<li>Disk: 500 GB HDD</li>
<li>OS: Debian GNU/Linux 11 (bullseye)</li>
</ul>
<p>After successfully installation of my Debian system, install some necessary tools:</p>
<div class="highlight"><pre>apt-get install vim mc net-tools sudo
</pre></div>

<ul>
<li>Change sudoers file:</li>
</ul>
<div class="highlight"><pre><span class="gd">--- /etc/sudoers-orig 2021-10-11 10:14:00.276397052 +0200</span>
<span class="gi">+++ /etc/sudoers  2021-10-11 10:14:20.832894911 +0200</span>
<span class="gu">@@ -20,7 +20,7 @@</span>
 root ALL=(ALL:ALL) ALL

 # Allow members of group sudo to execute any command
<span class="gd">-%sudo  ALL=(ALL:ALL) ALL</span>
<span class="gi">+%sudo  ALL=(ALL:ALL) NOPASSWD:ALL</span>

 # See sudoers(5) for more information on &quot;@include&quot; directives:
</pre></div>

<ul>
<li>Add user to <code>sudo</code> group (<code>/usr/sbin/visudo</code>)</li>
</ul>
<div class="highlight"><pre>/usr/sbin/usermod -aG sudo kube
</pre></div>

<h2 id="install-container-runtime">Install Container Runtime<a class="headerlink" href="#install-container-runtime" title="Permanent link"></a></h2>
<p>I always recommend to follow the official installation guide: <a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes">https://kubernetes.io/docs/setup/production-environment/container-runtimes</a>
Everything is well docomented and easy to follow. </p>
<p>Kubernetes will leave Docker support so we will user Containerd as container runtime. </p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Read more about Docker vs Kubernetes: <a href="https://kubernetes.io/blog/2020/12/02/dont-panic-kubernetes-and-docker/">https://kubernetes.io/blog/2020/12/02/dont-panic-kubernetes-and-docker/</a></p>
</div>
<p>Before you start you may want to check the official Docker installation page: <a href="https://docs.docker.com/engine/install/debian/">https://docs.docker.com/engine/install/debian/</a></p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>I know that I post a lot of link as references, but it is really important to understand how important is it to always read the official documentation.<br />
Almost all these installation steps are copy-pasted from the official sites. </p>
</div>
<ul>
<li>Install requirements</li>
</ul>
<div class="highlight"><pre>sudo bash
root@kube-test:/home/kube# apt-get install <span class="se">\</span>
    apt-transport-https <span class="se">\</span>
    ca-certificates <span class="se">\</span>
    curl <span class="se">\</span>
    gnupg <span class="se">\</span>
    lsb-release
</pre></div>

<ul>
<li>Add GPG key</li>
</ul>
<div class="highlight"><pre>curl -fsSL https://download.docker.com/linux/debian/gpg <span class="p">|</span> sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

<span class="nb">echo</span> <span class="se">\</span>
  <span class="s2">&quot;deb [arch=</span><span class="k">$(</span>dpkg --print-architecture<span class="k">)</span><span class="s2"> signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/debian \</span>
<span class="s2">  </span><span class="k">$(</span>lsb_release -cs<span class="k">)</span><span class="s2"> stable&quot;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</pre></div>

<ul>
<li>Install Docker &amp; containerd</li>
</ul>
<div class="highlight"><pre>apt-get update
apt-get install docker-ce docker-ce-cli containerd.io
</pre></div>

<ul>
<li>Check the installtion</li>
</ul>
<div class="highlight"><pre>docker info
docker run hello-world
</pre></div>

<ul>
<li>Prepare Containerd for Kubernetes</li>
</ul>
<div class="highlight"><pre>cat <span class="s">&lt;&lt;EOF | sudo tee /etc/modules-load.d/containerd.conf</span>
<span class="s">overlay</span>
<span class="s">br_netfilter</span>
<span class="s">EOF</span>
</pre></div>

<div class="highlight"><pre>modprobe overlay
modprobe br_netfilter
</pre></div>

<div class="highlight"><pre>cat <span class="s">&lt;&lt;EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf</span>
<span class="s">net.bridge.bridge-nf-call-iptables  = 1</span>
<span class="s">net.ipv4.ip_forward                 = 1</span>
<span class="s">net.bridge.bridge-nf-call-ip6tables = 1</span>
<span class="s">EOF</span>

sudo sysctl --system

sudo mkdir -p /etc/containerd
containerd config default <span class="p">|</span> sudo tee /etc/containerd/config.toml


systemctl restart containerd
systemctl status containerd
</pre></div>

<ul>
<li>Using the systemd cgroup drive</li>
</ul>
<div class="highlight"><pre>cp /etc/containerd/config.toml /etc/containerd/config.toml-orig
</pre></div>

<p><strong>Edit the <code>/etc/containerd/config.toml</code> file</strong></p>
<div class="highlight"><pre><span class="gd">--- /etc/containerd/config.toml-orig  2021-10-11 10:33:39.603577510 +0200</span>
<span class="gi">+++ /etc/containerd/config.toml 2021-10-11 10:35:01.753393462 +0200</span>
<span class="gu">@@ -94,6 +94,7 @@</span>
           privileged_without_host_devices = false
           base_runtime_spec = &quot;&quot;
           [plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options]
<span class="gi">+            SystemdCgroup = true</span>
     [plugins.&quot;io.containerd.grpc.v1.cri&quot;.cni]
       bin_dir = &quot;/opt/cni/bin&quot;
       conf_dir = &quot;/etc/cni/net.d&quot;
</pre></div>

<h2 id="install-kubernetes">Install Kubernetes<a class="headerlink" href="#install-kubernetes" title="Permanent link"></a></h2>
<p>Follow the steps described here: <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/">https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/</a></p>
<h3 id="installing-kubeadm">Installing kubeadm<a class="headerlink" href="#installing-kubeadm" title="Permanent link"></a></h3>
<div class="highlight"><pre>cat <span class="s">&lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf</span>
<span class="s">br_netfilter</span>
<span class="s">EOF</span>

cat <span class="s">&lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf</span>
<span class="s">net.bridge.bridge-nf-call-ip6tables = 1</span>
<span class="s">net.bridge.bridge-nf-call-iptables = 1</span>
<span class="s">EOF</span>
sudo sysctl --system
</pre></div>

<div class="highlight"><pre>apt-get update
apt-get install -y apt-transport-https ca-certificates curl

curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg
<span class="nb">echo</span> <span class="s2">&quot;deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&quot;</span> <span class="p">|</span>  tee /etc/apt/sources.list.d/kubernetes.list

sudo apt-get update
</pre></div>

<p>Now we do some extra steps before installing the kubeadm. In the world of Kubernetes it is important to install the same version of kubeadm kubelet and kubectl. So fist we check the avaiable versions:</p>
<pre class="command-line" data-user="root" data-host="mkdocs" data-output="2-10"><code class="language-bash">apt-cache madison kubeadm | egrep '(1.22|1.21)'
   kubeadm |  1.22.2-00 | https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages
   kubeadm |  1.22.1-00 | https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages
   kubeadm |  1.22.0-00 | https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages
   kubeadm |  1.21.5-00 | https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages
   kubeadm |  1.21.4-00 | https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages
   kubeadm |  1.21.3-00 | https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages
   kubeadm |  1.21.2-00 | https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages
   kubeadm |  1.21.1-00 | https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages
   kubeadm |  1.21.0-00 | https://apt.kubernetes.io kubernetes-xenial/main amd64 Packages</code></pre>

<p>We won&rsquo;t install the latest version in order to be able to show you an update process as well.</p>
<div class="highlight"><pre>apt-get install -y <span class="nv">kubelet</span><span class="o">=</span>1.21.5-00 <span class="nv">kubeadm</span><span class="o">=</span>1.21.5-00 <span class="nv">kubectl</span><span class="o">=</span>1.21.5-00
apt-mark hold kubelet kubeadm kubectl
</pre></div>

<div class="admonition info">
<p class="admonition-title">Info</p>
<p>We don&rsquo;t want to update kubeadm, kubeclt and kubelet with system (os) updates (apt-get update &amp; upgrade). Kubernetes update has its own process. Always be careful when update you base system, and never update these packages alongside with the underlying os.</p>
</div>
<p><strong>Check the installed version</strong>
<pre class="command-line" data-user="root" data-host="mkdocs" data-output="2-11"><code class="language-bash">kubeadm version -o yaml
clientVersion:
  buildDate: &ldquo;2021-09-15T21:09:27Z&rdquo;
  compiler: gc
  gitCommit: aea7bbadd2fc0cd689de94a54e5b7b758869d691
  gitTreeState: clean
  gitVersion: v1.21.5
  goVersion: go1.16.8
  major: &ldquo;1&rdquo;
  minor: &ldquo;21&rdquo;
  platform: linux/amd64</code></pre></p>
<h3 id="init-the-cluster">Init the cluster<a class="headerlink" href="#init-the-cluster" title="Permanent link"></a></h3>
<p>Check the breif help of the <code>kubeadm init</code> command:</p>
<div class="highlight"><pre>kubeadm init --help
</pre></div>

<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Disable SWAP before you start, otherwise you will get this error: <code>ERROR Swap]: running with swap on is not supported. Please disable swap</code><br />
To do this remove the corresponding line from <code>/etc/fstab</code> and run <code>swapoff --all</code> command.</p>
</div>
<p><strong>Options</strong></p>
<ul>
<li><code>--cri-socket /var/run/containerd/containerd.sock</code> &ndash;&gt; We want to use Containerd as container runtime insted of the default docker.</li>
<li><code>--service-cidr 10.22.0.0/24</code> and  <code>--pod-network-cidr 10.23.0.0/24</code> &ndash;&gt; Really important to size well your internal Kubernets network. Be sure that none of these IP address ranges don&rsquo;t overlap your phisical network, VPN connection or each other. Since this is only a demo system it will be enough about 250 IP address for PODS and Services. </li>
</ul>
<pre class="command-line" data-user="kube" data-host="kube-test" data-output="5-74"><code class="language-bash">kubeadm init \
--cri-socket /var/run/containerd/containerd.sock \
--service-cidr 10.22.0.0/24 \
--pod-network-cidr 10.23.0.0/24
I1011 10:54:59.868163    6330 version.go:254] remote version is much newer: v1.22.2; falling back to: stable-1.21
[init] Using Kubernetes version: v1.21.5
[preflight] Running pre-flight checks
[preflight] Pulling images required for setting up a Kubernetes cluster
[preflight] This might take a minute or two, depending on the speed of your internet connection
[preflight] You can also perform this action in beforehand using 'kubeadm config images pull'
[certs] Using certificateDir folder "/etc/kubernetes/pki"
[certs] Generating "ca" certificate and key
[certs] Generating "apiserver" certificate and key
[certs] apiserver serving cert is signed for DNS names [kube-test kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.22.0.1 172.16.1.214]
[certs] Generating "apiserver-kubelet-client" certificate and key
[certs] Generating "front-proxy-ca" certificate and key
[certs] Generating "front-proxy-client" certificate and key
[certs] Generating "etcd/ca" certificate and key
[certs] Generating "etcd/server" certificate and key
[certs] etcd/server serving cert is signed for DNS names [kube-test localhost] and IPs [172.16.1.214 127.0.0.1 ::1]
[certs] Generating "etcd/peer" certificate and key
[certs] etcd/peer serving cert is signed for DNS names [kube-test localhost] and IPs [172.16.1.214 127.0.0.1 ::1]
[certs] Generating "etcd/healthcheck-client" certificate and key
[certs] Generating "apiserver-etcd-client" certificate and key
[certs] Generating "sa" key and public key
[kubeconfig] Using kubeconfig folder "/etc/kubernetes"
[kubeconfig] Writing "admin.conf" kubeconfig file
[kubeconfig] Writing "kubelet.conf" kubeconfig file
[kubeconfig] Writing "controller-manager.conf" kubeconfig file
[kubeconfig] Writing "scheduler.conf" kubeconfig file
[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"
[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"
[kubelet-start] Starting the kubelet
[control-plane] Using manifest folder "/etc/kubernetes/manifests"
[control-plane] Creating static Pod manifest for "kube-apiserver"
[control-plane] Creating static Pod manifest for "kube-controller-manager"
[control-plane] Creating static Pod manifest for "kube-scheduler"
[etcd] Creating static Pod manifest for local etcd in "/etc/kubernetes/manifests"
[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory "/etc/kubernetes/manifests". This can take up to 4m0s
[kubelet-check] Initial timeout of 40s passed.
[apiclient] All control plane components are healthy after 42.005098 seconds
[upload-config] Storing the configuration used in ConfigMap "kubeadm-config" in the "kube-system" Namespace
[kubelet] Creating a ConfigMap "kubelet-config-1.21" in namespace kube-system with the configuration for the kubelets in the cluster
[upload-certs] Skipping phase. Please see --upload-certs
[mark-control-plane] Marking the node kube-test as control-plane by adding the labels: [node-role.kubernetes.io/master(deprecated) node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]
[mark-control-plane] Marking the node kube-test as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]
[bootstrap-token] Using token: gvcye3.n7xemwaq8a94t8bs
[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes
[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
[bootstrap-token] Creating the "cluster-info" ConfigMap in the "kube-public" namespace
[kubelet-finalize] Updating "/etc/kubernetes/kubelet.conf" to point to a rotatable kubelet client certificate and key
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy

Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

Alternatively, if you are the root user, you can run:

  export KUBECONFIG=/etc/kubernetes/admin.conf

You should now deploy a pod network to the cluster.
Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join 172.16.1.214:6443 --token gvcye3.n7xemwaq8a94t8bs \
  --discovery-token-ca-cert-hash sha256:bf86bed07219b08acaab0dc5451b3c4ddfd550a5b4b6295d5594758e693cf7e9 </code></pre>

<p>Beleve or not our Single node Kubernetes cluster is almost ready. :)</p>
<p>Check it:</p>
<div class="highlight"><pre>mkdir -p <span class="nv">$HOME</span>/.kube
sudo cp -i /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
sudo chown <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> <span class="nv">$HOME</span>/.kube/config

kubectl get nodes -o wide
</pre></div>

<p>Output looks like this:
<div class="highlight"><pre>NAME        STATUS     ROLES                  AGE     VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION   CONTAINER-RUNTIME
kube-test   NotReady   control-plane,master   5m26s   v1.21.5   172.16.1.214   &lt;none&gt;        Debian GNU/Linux 11 (bullseye)   5.10.0-9-amd64   containerd://1.4.11
</pre></div></p>
<p>It is beutiful, isn&rsquo;t it?</p>
<h3 id="why-my-node-is-in-notready-state">Why my node is in <code>NotReady</code> state?<a class="headerlink" href="#why-my-node-is-in-notready-state" title="Permanent link"></a></h3>
<p>I can say that this behavior is normal in case of newly installed Kubernetes cluster. Check the reaseon:</p>
<pre class="command-line" data-user="kube" data-host="kube-test" data-output="2-9"><code class="language-bash">kubectl get pods --all-namespaces -o wide
NAMESPACE     NAME                                READY   STATUS    RESTARTS   AGE     IP             NODE        NOMINATED NODE   READINESS GATES
kube-system   coredns-558bd4d5db-8tzmf            0/1     Pending   0          9m42s   <none>         <none>      <none>           <none>
kube-system   coredns-558bd4d5db-l6gtq            0/1     Pending   0          9m42s   <none>         <none>      <none>           <none>
kube-system   etcd-kube-test                      1/1     Running   0          10m     172.16.1.214   kube-test   <none>           <none>
kube-system   kube-apiserver-kube-test            1/1     Running   0          9m49s   172.16.1.214   kube-test   <none>           <none>
kube-system   kube-controller-manager-kube-test   1/1     Running   0          9m57s   172.16.1.214   kube-test   <none>           <none>
kube-system   kube-proxy-nhm2h                    1/1     Running   0          9m43s   172.16.1.214   kube-test   <none>           <none>
kube-system   kube-scheduler-kube-test            1/1     Running   0          9m58s   172.16.1.214   kube-test   <none>           <none></code></pre>

<p>You can see that the coredns pods are in pending state. These pods are responsible for internal DNS queries inside the Cluster Network. What should be the problem? We don&rsquo;t have any network plugin installed in the cluster....</p>
<p>Links: </p>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/">https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/</a></li>
<li><a href="https://kubevious.io/blog/post/comparing-kubernetes-container-network-interface-cni-providers">https://kubevious.io/blog/post/comparing-kubernetes-container-network-interface-cni-providers</a></li>
</ul>
<p>As you can see that there are a lot of varions of network plugins. For this little home environment I chose weave: <a href="https://www.weave.works/docs/net/latest/kubernetes/kube-addon/#install">https://www.weave.works/docs/net/latest/kubernetes/kube-addon/#install</a></p>
<p>It is really simple to install, can be achieved with only one command:</p>
<pre class="command-line" data-user="kube" data-host="kube-test" data-output="2-7"><code class="language-bash">kubectl apply -f "https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\n')"
serviceaccount/weave-net created
clusterrole.rbac.authorization.k8s.io/weave-net created
clusterrolebinding.rbac.authorization.k8s.io/weave-net created
role.rbac.authorization.k8s.io/weave-net created
rolebinding.rbac.authorization.k8s.io/weave-net created
daemonset.apps/weave-net created</code></pre>

<p>Check again the cluster:</p>
<pre class="command-line" data-user="kube" data-host="kube-test" data-output="2-10, 12-13"><code class="language-bash">kubectl get pods --all-namespaces -o wide
NAMESPACE     NAME                                READY   STATUS    RESTARTS   AGE     IP             NODE        NOMINATED NODE   READINESS GATES
kube-system   coredns-558bd4d5db-8tzmf            1/1     Running   0          18m     10.32.0.3      kube-test   <none>           <none>
kube-system   coredns-558bd4d5db-l6gtq            1/1     Running   0          18m     10.32.0.2      kube-test   <none>           <none>
kube-system   etcd-kube-test                      1/1     Running   0          18m     172.16.1.214   kube-test   <none>           <none>
kube-system   kube-apiserver-kube-test            1/1     Running   0          18m     172.16.1.214   kube-test   <none>           <none>
kube-system   kube-controller-manager-kube-test   1/1     Running   0          18m     172.16.1.214   kube-test   <none>           <none>
kube-system   kube-proxy-nhm2h                    1/1     Running   0          18m     172.16.1.214   kube-test   <none>           <none>
kube-system   kube-scheduler-kube-test            1/1     Running   0          18m     172.16.1.214   kube-test   <none>           <none>
kube-system   weave-net-l8xkh                     2/2     Running   1          2m22s   172.16.1.214   kube-test   <none>           <none>
kubectl get nodes -o wide
NAME        STATUS   ROLES                  AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION   CONTAINER-RUNTIME
kube-test   Ready    control-plane,master   18m   v1.21.5   172.16.1.214   <none>        Debian GNU/Linux 11 (bullseye)   5.10.0-9-amd64   containerd://1.4.11</code></pre>

<p>Now we really have a working single node Kubernetes cluster. </p>
<p>Before jump to the next section take a look at the node role: <code>control-plane,master</code><br />
This means the only node we hava acts as control-plane and master, since we won&rsquo;t have any other worker nodes this nodes must have worker role as well:</p>
<div class="highlight"><pre>kubectl label node kube-test node-role.kubernetes.io/worker<span class="o">=</span>
</pre></div>

<p>But this is not enoguh because the master nodes have taint by default: <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/</a></p>
<p>You can check the taint with <code>kubectl get node kube-test -o yaml</code> command:</p>
<div class="highlight"><pre>...
  taints:
  - effect: NoSchedule
    key: node-role.kubernetes.io/maste
</pre></div>

<p>Remove this taint:
<div class="highlight"><pre>kubectl taint nodes kube-test node-role.kubernetes.io/master<span class="o">=</span>:NoSchedule-
</pre></div></p>
<h2 id="post-installation-steps">Post Installation Steps<a class="headerlink" href="#post-installation-steps" title="Permanent link"></a></h2>
<h3 id="scale-down-the-coredns-deployment">Scale Down The CoreDNS Deployment<a class="headerlink" href="#scale-down-the-coredns-deployment" title="Permanent link"></a></h3>
<p>Remember we have only one node in this demo cluster. It&rsquo;s not neccessary to have multiple instance of our applications, because all of them will run on this single node, and this behaviour doesn&rsquo;t give us any extras. </p>
<div class="highlight"><pre>kubectl edit -n kube-system deployment coredns
</pre></div>

<p>Change the replicas to 1:
<div class="highlight"><pre><span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">progressDeadlineSeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">600</span>
  <span class="l l-Scalar l-Scalar-Plain">replicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="l l-Scalar l-Scalar-Plain">revisionHistoryLimit</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
  <span class="l l-Scalar l-Scalar-Plain">selector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">matchLabels</span><span class="p p-Indicator">:</span>
</pre></div></p>
<p><strong>Check</strong></p>
<pre class="command-line" data-user="kube" data-host="kube-test" data-output="2-9"><code class="language-bash">kubectl -n kube-system get pods
NAME                                READY   STATUS    RESTARTS   AGE
coredns-558bd4d5db-l6gtq            1/1     Running   0          32m
etcd-kube-test                      1/1     Running   0          33m
kube-apiserver-kube-test            1/1     Running   0          33m
kube-controller-manager-kube-test   1/1     Running   0          33m
kube-proxy-nhm2h                    1/1     Running   0          32m
kube-scheduler-kube-test            1/1     Running   0          33m
weave-net-l8xkh                     2/2     Running   1          16m</code></pre>

<h3 id="install-kuberntes-metrics-server">Install Kuberntes Metrics Server<a class="headerlink" href="#install-kuberntes-metrics-server" title="Permanent link"></a></h3>
<p>In order to get basic performance information about our cluster or pods we have to install Kubernetes Metrics Server:</p>
<ul>
<li><a class="magiclink magiclink-github magiclink-repository" href="https://github.com/kubernetes-sigs/metrics-server" title="GitHub Repository: kubernetes-sigs/metrics-server">kubernetes-sigs/metrics-server</a></li>
</ul>
<div class="highlight"><pre>kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
</pre></div>

<p>You probalby will get the following error:</p>
<div class="highlight"><pre>kubectl -n kube-system logs metrics-server-6775f684f6-gxpcz
</pre></div>

<p>Output: </p>
<div class="highlight"><pre>E1011 09:43:22.529064       1 scraper.go:139] &quot;Failed to scrape node&quot; err=&quot;Get \&quot;https://172.16.1.214:10250/stats/summary?only_cpu_and_memory=true\&quot;: x509: cannot validate certificate for 172.16.1.214 because it doesn&#39;t contain any IP SANs&quot; node=&quot;kube-test&quot;
</pre></div>

<p>Edit the deployment <code>kubectl -n kube-system edit  deployment metrics-server</code> and add this lint to <code>args</code>:</p>
<div class="highlight"><pre>      <span class="l l-Scalar l-Scalar-Plain">containers</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">args</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--kubelet-insecure-tls</span>
</pre></div>

<p><strong>Check</strong>
<pre class="command-line" data-user="kube" data-host="kube-test" data-output="2-10"><code class="language-bash">kubectl -n kube-system top pods
NAME                                CPU(cores)   MEMORY(bytes) <br />
coredns-558bd4d5db-l6gtq            3m           18Mi          <br />
etcd-kube-test                      16m          41Mi          <br />
kube-apiserver-kube-test            76m          333Mi         <br />
kube-controller-manager-kube-test   12m          60Mi          <br />
kube-proxy-nhm2h                    1m           20Mi          <br />
kube-scheduler-kube-test            4m           25Mi          <br />
metrics-server-6775f684f6-gxpcz     6m           18Mi          <br />
weave-net-l8xkh                     2m           61Mi</code></pre></p>
<h3 id="install-nginx-ingress-controller">Install (Nginx) Ingress Controller<a class="headerlink" href="#install-nginx-ingress-controller" title="Permanent link"></a></h3>
<p>Maybe this it the most interesting part of this article as for now. You can chose from various ingress controller to install. Check the official documentation for more details:</p>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/">https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/</a></li>
</ul>
<p>For this demo I choose the NGinx Ingress Controller. I think it is easy to install and maybe some of your already have experience with NGinx on bare metal. I can&rsquo;t tell you any other news than checking the official docs: <a href="https://kubernetes.github.io/ingress-nginx/deploy/">https://kubernetes.github.io/ingress-nginx/deploy/</a> </p>
<p>We are going to follow the Bare Metal installation: <a href="https://kubernetes.github.io/ingress-nginx/deploy/#bare-metal">https://kubernetes.github.io/ingress-nginx/deploy/#bare-metal</a></p>
<div class="highlight"><pre>kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.49.3/deploy/static/provider/baremetal/deploy.yaml

<span class="c1"># Check The Install Process: </span>

kubectl get pods -n ingress-nginx <span class="se">\</span>
  -l app.kubernetes.io/name<span class="o">=</span>ingress-nginx --watch
</pre></div>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do NOT deploy the latest version (v1.0.3)! It won&rsquo;t work with hostNetwork on Bare Metal installation. The address field will be blank even if you specify <code>--report-node-internal-ip-address</code> command line arguments. I&rsquo;ve tried a lot of settings but none of them worked.</p>
</div>
<p>Wait for this line:
<div class="highlight"><pre>ingress-nginx-controller-6c68f5b657-hvfn9   1/1     Running             0          60s
</pre></div></p>
<p>This is the default installation process. But at this point we have only NodePort service for incomming traffic:</p>
<pre class="command-line" data-user="kube" data-host="kube-test" data-output="2-4"><code class="language-bash">kubectl -n ingress-nginx get services
NAME                                 TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)                      AGE
ingress-nginx-controller             NodePort    10.22.0.78    <none>        80:30016/TCP,443:32242/TCP   104s
ingress-nginx-controller-admission   ClusterIP   10.22.0.242   <none>        443/TCP                      104s</code></pre>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Please read very carefully this documentation: <a href="https://kubernetes.github.io/ingress-nginx/deploy/baremetal/">https://kubernetes.github.io/ingress-nginx/deploy/baremetal/</a></p>
</div>
<p>This NodePort means that our NGinx ingress controller is accessible on every node in the cluster on <code>30016/TCP</code> and <code>32242/TCP</code>. It is OK if you planning to use these ports to access the applications inside the cluster.<br />
Or you can install a reverse proxy somewehere in you physical network. This can be the Kubernetes host itself. Configuring a reverse proxy could be a pain, and it is not the subject of this article.</p>
<p><strong>Check</strong></p>
<p>To check the NGinx Ingress Controller you should use another machine in your network. Most of the time I use curl to check if web server is running or not, but you can use your browser instead.</p>
<pre class="command-line" data-user="kube" data-host="kube-test" data-output="2-15,17-30"><code class="language-bash">curl -i http://172.16.1.214:30016 
HTTP/1.1 404 Not Found
Date: Mon, 11 Oct 2021 10:11:40 GMT
Content-Type: text/html
Content-Length: 146
Connection: keep-alive

<html>
<head><title>404 Not Found</title></head>
<body>
<center><h1>404 Not Found</h1></center>
<hr><center>nginx</center>
</body>
</html>

curl -ik https://172.16.1.214:32242
HTTP/2 404 
date: Mon, 11 Oct 2021 10:12:13 GMT
content-type: text/html
content-length: 146
strict-transport-security: max-age=15724800; includeSubDomains

<html>
<head><title>404 Not Found</title></head>
<body>
<center><h1>404 Not Found</h1></center>
<hr><center>nginx</center>
</body>
</html></code></pre>

<p>This is not the desired stat I want, I want to access my Ingresss Controller over the standard 80(http) and 443(https) ports, so choose the hostPort: <a href="https://kubernetes.github.io/ingress-nginx/deploy/baremetal/#via-the-host-network">https://kubernetes.github.io/ingress-nginx/deploy/baremetal/#via-the-host-network</a></p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>This setup absolutely not suitable for Production environment, but just enough for this demo.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This command does&rsquo;t not effects the <code>Service</code>. If you want to check the config describe your pod with <code>kubectl -n ingress-nginx describe  $(kubectl -n ingress-nginx get pods -o name | grep  "ingress-nginx-controller")</code> command and look for this line <code>Host Ports:    80/TCP, 443/TCP, 8443/TCP</code></p>
</div>
<p><strong>Check</strong></p>
<pre class="command-line" data-user="kube" data-host="kube-test" data-output="2-7,8-13"><code class="language-bash">curl -ikI https://172.16.1.214
HTTP/2 404 
date: Mon, 11 Oct 2021 10:29:13 GMT
content-type: text/html
content-length: 146
strict-transport-security: max-age=15724800; includeSubDomains

curl -ikI http://172.16.1.214
HTTP/1.1 404 Not Found
Date: Mon, 11 Oct 2021 10:29:16 GMT
Content-Type: text/html
Content-Length: 146
Connection: keep-alive</code></pre>

<h4 id="deploy-an-application-and-create-service-and-ingress-for-it">Deploy An Application And Create Service And Ingress For It<a class="headerlink" href="#deploy-an-application-and-create-service-and-ingress-for-it" title="Permanent link"></a></h4>
<p>For demonstration we deploy a Ghost (blog) instance.</p>
<div class="highlight"><pre>kubectl create deployment ghost-test --image<span class="o">=</span>ghost:latest
</pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Without explicitly specifying the namespace the pod will be created in the <code>default</code> namespace.</p>
</div>
<p>At this point we have a POD running, but we could not access it. First we need to create a <code>Service</code> object.</p>
<div class="highlight"><pre>kubectl create service clusterip ghost-test --tcp<span class="o">=</span>2368:2368
</pre></div>

<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Use the same name as the Deployment (ghost-test)! This will create the appropiate selector.</p>
</div>
<p><strong>Check the Service:</strong></p>
<pre class="command-line" data-user="kube" data-host="kube-test" data-output="2-16"><code class="language-bash">kubectl describe service ghost-test
Name:              ghost-test
Namespace:         default
Labels:            app=ghost-test
Annotations:       <none>
Selector:          app=ghost-test
Type:              ClusterIP
IP Family Policy:  SingleStack
IP Families:       IPv4
IP:                10.22.0.184
IPs:               10.22.0.184
Port:              2368-2368  2368/TCP
TargetPort:        2368/TCP
Endpoints:         10.32.0.3:2368
Session Affinity:  None
Events:            <none></code></pre>

<p>The most important thing here is the Endpoints:</p>
<div class="highlight"><pre>Endpoints:         10.32.0.3:2368
</pre></div>

<p>The IP address should point to the IP address of the Ghost POD:</p>
<pre class="command-line" data-user="kube" data-host="kube-test" data-output="2,3"><code class="language-bash">get pods -o wide
NAME                          READY   STATUS    RESTARTS   AGE   IP          NODE        NOMINATED NODE   READINESS GATES
ghost-test-66846549b5-8z6mj   1/1     Running   0          15m   10.32.0.3   kube-test   <none>           <none></code></pre>

<p><strong>The last step is to create the <code>Ingress</code> object.</strong></p>
<p>The <code>yaml</code> file:
<div class="highlight"><pre><span class="l l-Scalar l-Scalar-Plain">cat &lt;&lt;EOF&gt;ghost-ingress.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ghost-web</span>
  <span class="l l-Scalar l-Scalar-Plain">namespace</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">rules</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ghost-test.example.local</span>
    <span class="l l-Scalar l-Scalar-Plain">http</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">paths</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pathType</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ImplementationSpecific</span>
        <span class="l l-Scalar l-Scalar-Plain">backend</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">service</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ghost-test</span>
            <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span>
              <span class="l l-Scalar l-Scalar-Plain">number</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2368</span>
<span class="l l-Scalar l-Scalar-Plain">EOF</span>
</pre></div></p>
<p>Apply the yaml:</p>
<div class="highlight"><pre>kubectl apply -f ghost-ingress.yaml
</pre></div>

<p><strong>Check the ingress</strong></p>
<pre class="command-line" data-user="kube" data-host="kube-test" data-output="2-16"><code class="language-bash">kubectl describe ingress ghost-web 
Name:             ghost-web
Namespace:        default
Address:          172.16.1.214
Default backend:  default-http-backend:80 (<error: endpoints "default-http-backend" not found>)
Rules:
  Host                     Path  Backends
  ----                     ----  --------
  ghost-test.k8s-test.loc  
                              ghost-test:2368 (10.32.0.4:2368)
Annotations:               <none>
Events:
  Type    Reason  Age                   From                      Message
  ----    ------  ----                  ----                      -------
  Normal  Sync    3m19s                 nginx-ingress-controller  Scheduled for sync
  Normal  Sync    104s (x2 over 2m55s)  nginx-ingress-controller  Scheduled for sync</code></pre>

<p><strong>Check With <code>curl</code></strong></p>
<div class="highlight"><pre>curl  -H  <span class="s1">&#39;Host: ghost-test.example.local&#39;</span> http://172.16.1.212
</pre></div>

<h4 id="dns-entries">DNS Entries<a class="headerlink" href="#dns-entries" title="Permanent link"></a></h4>
<p>The above example works only if you overwrite the HTTP Host header with <code>'Host: ghost-test.example.local'</code>. This is because the <code>ghost-test.example.local</code> domain name does not exist. At this point we have to decide how to manage the DNS. The Kubernetes Igress works the best if we have a wildcard DNS entry. I don&rsquo;t want to get deep insude the DNS problem, but give you some tips:</p>
<ul>
<li>If your home router support static DNS entries you can define one, for example: <code>*.k8s.test.local</code>. My <strong>Mikrotik</strong> router has this function, so I can easily create a local wildcard DNS. Example <code>/ip dns static add address=172.16.1.214 regexp=.k8s-test.loc</code></li>
<li>You can use your existing domain, or buy a new one. For example I have vinczejanos.info domain registered at Godaddy. I can add a wildcard DNS record which points to the IP address of the Kubernetes machine. (<code>*.local.k8s.vinczejanos.info</code>) Be aware that this can be a security risk, everybody on the public Internet can resolve this host name, and it points to a private IP address.</li>
<li>You can set up your own DNS server. Maybe the easiest way is the DNSMasq, but Bind9 can be also a good alternative. (Bind maybe a bit robust for this purpose.) In this case you have to configure all of your clients to use the new DNS server. </li>
<li>Since this is only a demo environment, a suitable solution can be to use your <code>hosts</code> file, but keep in mind that hosts file doesn&rsquo;t support wildcards, so you have to specify all host names one-by-one. The hosts file must be updated on all the host from where you want to access your Kubernetes Cluster.</li>
</ul>
<p>??? example
    Hosts file location:</p>
<pre><code>* Linux: `/etc/hosts`
* Windows: `Windows\System32\drivers\etc`
</code></pre>
<p>Now, we have a fully functional Single Node Kubernetes Cluster. </p>
<h2 id="install-kubernetes-dashboard">Install Kubernetes Dashboard<a class="headerlink" href="#install-kubernetes-dashboard" title="Permanent link"></a></h2>
<p>Link: <a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/</a></p>
<div class="highlight"><pre>kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.3.1/aio/deploy/recommended.yaml
</pre></div>

<p>Check if the pods are fine.</p>
<pre class="command-line" data-user="kube" data-host="kube-test" data-output="2-4"><code class="language-bash">kubectl -n kubernetes-dashboard get pods
NAME                                         READY   STATUS    RESTARTS   AGE
dashboard-metrics-scraper-856586f554-pgq5l   1/1     Running   0          47s
kubernetes-dashboard-67484c44f6-vjlkw        1/1     Running   0          47s</code></pre>

<h3 id="create-an-ingress">Create An Ingress<a class="headerlink" href="#create-an-ingress" title="Permanent link"></a></h3>
<p><strong>Check The Service</strong></p>
<pre class="command-line" data-user="kube" data-host="kube-test" data-output="2-17"><code class="language-bash">kubectl -n kubernetes-dashboard describe  svc kubernetes-dashboard
Name:              kubernetes-dashboard
Namespace:         kubernetes-dashboard
Labels:            k8s-app=kubernetes-dashboard
Annotations:       <none>
Selector:          k8s-app=kubernetes-dashboard
Type:              ClusterIP
IP Family Policy:  SingleStack
IP Families:       IPv4
IP:                10.22.0.56
IPs:               10.22.0.56
Port:              <unset>  443/TCP
TargetPort:        8443/TCP
Endpoints:         10.32.0.5:8443
Session Affinity:  None
Events:            <none></code></pre>

<p><strong>The Ingress <code>yaml</code></strong></p>
<div class="highlight"><pre><span class="l l-Scalar l-Scalar-Plain">cat &lt;&lt;EOF&gt;kubernetes-dashboard-ingress.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
  <span class="l l-Scalar l-Scalar-Plain">namespace</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
  <span class="l l-Scalar l-Scalar-Plain">annotations</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">nginx.ingress.kubernetes.io/backend-protocol</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">HTTPS</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">rules</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">host</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">dashboard.k8s-test.loc</span>
      <span class="l l-Scalar l-Scalar-Plain">http</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">paths</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/</span>
            <span class="l l-Scalar l-Scalar-Plain">pathType</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Prefix</span>
            <span class="l l-Scalar l-Scalar-Plain">backend</span><span class="p p-Indicator">:</span>
              <span class="l l-Scalar l-Scalar-Plain">service</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
                <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span>
                  <span class="l l-Scalar l-Scalar-Plain">number</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="l l-Scalar l-Scalar-Plain">EOF</span>
</pre></div>

<p>Apply the ingress:</p>
<div class="highlight"><pre>kubectl apply -f kubernetes-dashboard-ingress.yaml
</pre></div>

<p>Now I can access the Kubernetes Dashboard at <a href="https://dashboard.k8s-test.loc">https://dashboard.k8s-test.loc</a></p>
<h3 id="get-the-thoken">Get The Thoken<a class="headerlink" href="#get-the-thoken" title="Permanent link"></a></h3>
<p>When you see the login screen, you are asked for the token or kubeconfig file. I choose the simpier way and use token.</p>
<p>First obtain the name of the secret:
<pre class="command-line" data-user="kube" data-host="kube-test" data-output="2-7"><code class="language-bash">kubectl -n kubernetes-dashboard get secrets
NAME                               TYPE                                  DATA   AGE
default-token-v85k8                kubernetes.io/service-account-token   3      14m
kubernetes-dashboard-certs         Opaque                                0      14m
kubernetes-dashboard-csrf          Opaque                                1      14m
kubernetes-dashboard-key-holder    Opaque                                2      14m
kubernetes-dashboard-token-24jfb   kubernetes.io/service-account-token   3      14m</code></pre></p>
<p>We need this: <strong>kubernetes-dashboard-token-24jfb</strong></p>
<p><strong>Get the token:</strong></p>
<div class="highlight"><pre>kubectl -n kubernetes-dashboard get secret kubernetes-dashboard-token-24jfb -o json <span class="p">|</span> jq -r  <span class="s1">&#39;.data.token&#39;</span> <span class="p">|</span> base64 -d <span class="p">;</span> <span class="nb">echo</span> 
</pre></div>

<p>You will see a lot of error message like this:</p>
<div class="highlight"><pre>namespaces is forbidden: User &quot;system:serviceaccount:kubernetes-dashboard:kubernetes-dashboard&quot; cannot list resource &quot;namespaces&quot; in API group &quot;&quot; at the cluster scope
</pre></div>

<p>Screenshot:</p>
<p><img alt="Error" src="/assets/images/DeepinScreenshot_select-area_20211011165036.png" /></p>
<p>I don&rsquo;t want to bother with roles and rolebindigns at this article. I want quick win, so edit the <code>kubernetes-dashboard</code> ClusterRole.</p>
<div class="highlight"><pre>kubectl  edit  clusterrole kubernetes-dashboard
</pre></div>

<p>And modify:
<div class="highlight"><pre>root@kube-test:~# diff -u 01 02
   labels:
     k8s-app: kubernetes-dashboard
   name: kubernetes-dashboard

 rules:
 - apiGroups:
<span class="gd">-  - metrics.k8s.io</span>
<span class="gi">+  - &#39;*&#39;</span>
   resources:
<span class="gd">-  - pods</span>
<span class="gd">-  - nodes</span>
<span class="gi">+  - &#39;*&#39;</span>
   verbs:
<span class="gd">-  - get</span>
<span class="gd">-  - list</span>
<span class="gd">-  - watch</span>
<span class="gi">+  - &#39;*&#39;</span>
<span class="gi">+- nonResourceURLs:</span>
<span class="gi">+  - &#39;*&#39;</span>
<span class="gi">+  verbs:</span>
<span class="gi">+  - &#39;*&#39;</span>
</pre></div></p>
<p>It should look like this:
<div class="highlight"><pre><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">annotations</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">kubectl.kubernetes.io/last-applied-configuration</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
      <span class="no">{&quot;apiVersion&quot;:&quot;rbac.authorization.k8s.io/v1&quot;,&quot;kind&quot;:&quot;ClusterRole&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;labels&quot;:{&quot;k8s-app&quot;:&quot;kubernetes-dashboard&quot;},&quot;name&quot;:&quot;kubernetes-dashboard&quot;},&quot;rules&quot;:[{&quot;apiGroups&quot;:[&quot;metrics.k8s.io&quot;],&quot;resources&quot;:[&quot;pods&quot;,&quot;nodes&quot;],&quot;verbs&quot;:[&quot;get&quot;,&quot;list&quot;,&quot;watch&quot;]}]}</span>
  <span class="l l-Scalar l-Scalar-Plain">creationTimestamp</span><span class="p p-Indicator">:</span> <span class="s">&quot;2021-10-11T14:33:17Z&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">labels</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">k8s-app</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
  <span class="l l-Scalar l-Scalar-Plain">resourceVersion</span><span class="p p-Indicator">:</span> <span class="s">&quot;15040&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">uid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">26495412-c50f-48fb-b3ce-448d42dff15b</span>
<span class="l l-Scalar l-Scalar-Plain">rules</span><span class="p p-Indicator">:</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">apiGroups</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&#39;*&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">resources</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&#39;*&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">verbs</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&#39;*&#39;</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">nonResourceURLs</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&#39;*&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">verbs</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&#39;*&#39;</span>
</pre></div></p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Do NOT do this in Production system! This way you give cluster-admin role to kubernetes-dashboard ServiceAccount. Everybody who knows the token can do anything with your Kubernetes cluster!</p>
</div></article></body></html>